var st=Object.defineProperty;var C=(t,r)=>{for(var e in r)st(t,e,{get:r[e],enumerable:!0})};var g=1e-6,u=typeof Float32Array<"u"?Float32Array:Array,R=Math.random;function _(t){return t>=0?Math.round(t):t%.5===0?Math.floor(t):Math.round(t)}var $r=Math.PI/180,te=180/Math.PI;var y={};C(y,{add:()=>_t,clone:()=>lt,copy:()=>ht,create:()=>ct,determinant:()=>dt,equals:()=>zt,exactEquals:()=>Rt,frob:()=>St,fromRotation:()=>ut,fromScaling:()=>yt,fromTranslation:()=>At,fromValues:()=>ft,identity:()=>xt,invert:()=>mt,mul:()=>Pt,multiply:()=>N,multiplyScalar:()=>Et,multiplyScalarAndAdd:()=>Tt,rotate:()=>Mt,scale:()=>vt,set:()=>pt,str:()=>wt,sub:()=>bt,subtract:()=>D,translate:()=>gt});function ct(){var t=new u(6);return u!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function lt(t){var r=new u(6);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function ht(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t}function xt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function ft(t,r,e,n,a,i){var s=new u(6);return s[0]=t,s[1]=r,s[2]=e,s[3]=n,s[4]=a,s[5]=i,s}function pt(t,r,e,n,a,i,s){return t[0]=r,t[1]=e,t[2]=n,t[3]=a,t[4]=i,t[5]=s,t}function mt(t,r){var e=r[0],n=r[1],a=r[2],i=r[3],s=r[4],c=r[5],l=e*i-n*a;return l?(l=1/l,t[0]=i*l,t[1]=-n*l,t[2]=-a*l,t[3]=e*l,t[4]=(a*c-i*s)*l,t[5]=(n*s-e*c)*l,t):null}function dt(t){return t[0]*t[3]-t[1]*t[2]}function N(t,r,e){var n=r[0],a=r[1],i=r[2],s=r[3],c=r[4],l=r[5],h=e[0],f=e[1],M=e[2],v=e[3],S=e[4],j=e[5];return t[0]=n*h+i*f,t[1]=a*h+s*f,t[2]=n*M+i*v,t[3]=a*M+s*v,t[4]=n*S+i*j+c,t[5]=a*S+s*j+l,t}function Mt(t,r,e){var n=r[0],a=r[1],i=r[2],s=r[3],c=r[4],l=r[5],h=Math.sin(e),f=Math.cos(e);return t[0]=n*f+i*h,t[1]=a*f+s*h,t[2]=n*-h+i*f,t[3]=a*-h+s*f,t[4]=c,t[5]=l,t}function vt(t,r,e){var n=r[0],a=r[1],i=r[2],s=r[3],c=r[4],l=r[5],h=e[0],f=e[1];return t[0]=n*h,t[1]=a*h,t[2]=i*f,t[3]=s*f,t[4]=c,t[5]=l,t}function gt(t,r,e){var n=r[0],a=r[1],i=r[2],s=r[3],c=r[4],l=r[5],h=e[0],f=e[1];return t[0]=n,t[1]=a,t[2]=i,t[3]=s,t[4]=n*h+i*f+c,t[5]=a*h+s*f+l,t}function ut(t,r){var e=Math.sin(r),n=Math.cos(r);return t[0]=n,t[1]=e,t[2]=-e,t[3]=n,t[4]=0,t[5]=0,t}function yt(t,r){return t[0]=r[0],t[1]=0,t[2]=0,t[3]=r[1],t[4]=0,t[5]=0,t}function At(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=r[0],t[5]=r[1],t}function wt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function St(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]+t[3]*t[3]+t[4]*t[4]+t[5]*t[5]+1)}function _t(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t[3]=r[3]+e[3],t[4]=r[4]+e[4],t[5]=r[5]+e[5],t}function D(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t[3]=r[3]-e[3],t[4]=r[4]-e[4],t[5]=r[5]-e[5],t}function Et(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t[4]=r[4]*e,t[5]=r[5]*e,t}function Tt(t,r,e,n){return t[0]=r[0]+e[0]*n,t[1]=r[1]+e[1]*n,t[2]=r[2]+e[2]*n,t[3]=r[3]+e[3]*n,t[4]=r[4]+e[4]*n,t[5]=r[5]+e[5]*n,t}function Rt(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]}function zt(t,r){var e=t[0],n=t[1],a=t[2],i=t[3],s=t[4],c=t[5],l=r[0],h=r[1],f=r[2],M=r[3],v=r[4],S=r[5];return Math.abs(e-l)<=g*Math.max(1,Math.abs(e),Math.abs(l))&&Math.abs(n-h)<=g*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(a-f)<=g*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(i-M)<=g*Math.max(1,Math.abs(i),Math.abs(M))&&Math.abs(s-v)<=g*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(c-S)<=g*Math.max(1,Math.abs(c),Math.abs(S))}var Pt=N,bt=D;var p={};C(p,{add:()=>Ct,ceil:()=>Ot,clone:()=>It,copy:()=>Yt,create:()=>k,cross:()=>Gt,dist:()=>ir,distance:()=>B,div:()=>ar,divide:()=>W,dot:()=>Xt,equals:()=>rr,exactEquals:()=>tr,floor:()=>Vt,forEach:()=>lr,fromValues:()=>Lt,inverse:()=>Wt,len:()=>sr,length:()=>G,lerp:()=>Jt,max:()=>Nt,min:()=>jt,mul:()=>nr,multiply:()=>H,negate:()=>Ht,normalize:()=>Bt,random:()=>Qt,round:()=>Dt,scale:()=>kt,scaleAndAdd:()=>Ft,set:()=>qt,sqrDist:()=>or,sqrLen:()=>cr,squaredDistance:()=>X,squaredLength:()=>J,str:()=>$t,sub:()=>er,subtract:()=>F,transformMat4:()=>Kt,transformQuat:()=>Ut,zero:()=>Zt});function k(){var t=new u(4);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function It(t){var r=new u(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function Lt(t,r,e,n){var a=new u(4);return a[0]=t,a[1]=r,a[2]=e,a[3]=n,a}function Yt(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t}function qt(t,r,e,n,a){return t[0]=r,t[1]=e,t[2]=n,t[3]=a,t}function Ct(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t[3]=r[3]+e[3],t}function F(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t[3]=r[3]-e[3],t}function H(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t[2]=r[2]*e[2],t[3]=r[3]*e[3],t}function W(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t[2]=r[2]/e[2],t[3]=r[3]/e[3],t}function Ot(t,r){return t[0]=Math.ceil(r[0]),t[1]=Math.ceil(r[1]),t[2]=Math.ceil(r[2]),t[3]=Math.ceil(r[3]),t}function Vt(t,r){return t[0]=Math.floor(r[0]),t[1]=Math.floor(r[1]),t[2]=Math.floor(r[2]),t[3]=Math.floor(r[3]),t}function jt(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t[2]=Math.min(r[2],e[2]),t[3]=Math.min(r[3],e[3]),t}function Nt(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t[2]=Math.max(r[2],e[2]),t[3]=Math.max(r[3],e[3]),t}function Dt(t,r){return t[0]=_(r[0]),t[1]=_(r[1]),t[2]=_(r[2]),t[3]=_(r[3]),t}function kt(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t}function Ft(t,r,e,n){return t[0]=r[0]+e[0]*n,t[1]=r[1]+e[1]*n,t[2]=r[2]+e[2]*n,t[3]=r[3]+e[3]*n,t}function B(t,r){var e=r[0]-t[0],n=r[1]-t[1],a=r[2]-t[2],i=r[3]-t[3];return Math.sqrt(e*e+n*n+a*a+i*i)}function X(t,r){var e=r[0]-t[0],n=r[1]-t[1],a=r[2]-t[2],i=r[3]-t[3];return e*e+n*n+a*a+i*i}function G(t){var r=t[0],e=t[1],n=t[2],a=t[3];return Math.sqrt(r*r+e*e+n*n+a*a)}function J(t){var r=t[0],e=t[1],n=t[2],a=t[3];return r*r+e*e+n*n+a*a}function Ht(t,r){return t[0]=-r[0],t[1]=-r[1],t[2]=-r[2],t[3]=-r[3],t}function Wt(t,r){return t[0]=1/r[0],t[1]=1/r[1],t[2]=1/r[2],t[3]=1/r[3],t}function Bt(t,r){var e=r[0],n=r[1],a=r[2],i=r[3],s=e*e+n*n+a*a+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e*s,t[1]=n*s,t[2]=a*s,t[3]=i*s,t}function Xt(t,r){return t[0]*r[0]+t[1]*r[1]+t[2]*r[2]+t[3]*r[3]}function Gt(t,r,e,n){var a=e[0]*n[1]-e[1]*n[0],i=e[0]*n[2]-e[2]*n[0],s=e[0]*n[3]-e[3]*n[0],c=e[1]*n[2]-e[2]*n[1],l=e[1]*n[3]-e[3]*n[1],h=e[2]*n[3]-e[3]*n[2],f=r[0],M=r[1],v=r[2],S=r[3];return t[0]=M*h-v*l+S*c,t[1]=-(f*h)+v*s-S*i,t[2]=f*l-M*s+S*a,t[3]=-(f*c)+M*i-v*a,t}function Jt(t,r,e,n){var a=r[0],i=r[1],s=r[2],c=r[3];return t[0]=a+n*(e[0]-a),t[1]=i+n*(e[1]-i),t[2]=s+n*(e[2]-s),t[3]=c+n*(e[3]-c),t}function Qt(t,r){r=r===void 0?1:r;var e,n,a,i,s,c,l;l=R(),e=l*2-1,n=(4*R()-2)*Math.sqrt(l*-l+l),s=e*e+n*n,l=R(),a=l*2-1,i=(4*R()-2)*Math.sqrt(l*-l+l),c=a*a+i*i;var h=Math.sqrt((1-s)/c);return t[0]=r*e,t[1]=r*n,t[2]=r*a*h,t[3]=r*i*h,t}function Kt(t,r,e){var n=r[0],a=r[1],i=r[2],s=r[3];return t[0]=e[0]*n+e[4]*a+e[8]*i+e[12]*s,t[1]=e[1]*n+e[5]*a+e[9]*i+e[13]*s,t[2]=e[2]*n+e[6]*a+e[10]*i+e[14]*s,t[3]=e[3]*n+e[7]*a+e[11]*i+e[15]*s,t}function Ut(t,r,e){var n=e[0],a=e[1],i=e[2],s=e[3],c=r[0],l=r[1],h=r[2],f=a*h-i*l,M=i*c-n*h,v=n*l-a*c;return f=f+f,M=M+M,v=v+v,t[0]=c+s*f+a*v-i*M,t[1]=l+s*M+i*f-n*v,t[2]=h+s*v+n*M-a*f,t[3]=r[3],t}function Zt(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function $t(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function tr(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]}function rr(t,r){var e=t[0],n=t[1],a=t[2],i=t[3],s=r[0],c=r[1],l=r[2],h=r[3];return Math.abs(e-s)<=g*Math.max(1,Math.abs(e),Math.abs(s))&&Math.abs(n-c)<=g*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(a-l)<=g*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(i-h)<=g*Math.max(1,Math.abs(i),Math.abs(h))}var er=F,nr=H,ar=W,ir=B,or=X,sr=G,cr=J,lr=(function(){var t=k();return function(r,e,n,a,i,s){var c,l;for(e||(e=4),n||(n=0),a?l=Math.min(a*e+n,r.length):l=r.length,c=n;c<l;c+=e)t[0]=r[c],t[1]=r[c+1],t[2]=r[c+2],t[3]=r[c+3],i(t,t,s),r[c]=t[0],r[c+1]=t[1],r[c+2]=t[2],r[c+3]=t[3];return r}})();var o={};C(o,{add:()=>mr,angle:()=>qr,ceil:()=>dr,clone:()=>hr,copy:()=>fr,create:()=>Q,cross:()=>Tr,dist:()=>Wr,distance:()=>$,div:()=>Hr,divide:()=>Z,dot:()=>Er,equals:()=>Nr,exactEquals:()=>jr,floor:()=>Mr,forEach:()=>Gr,fromValues:()=>xr,inverse:()=>Sr,len:()=>Dr,length:()=>rt,lerp:()=>Rr,max:()=>gr,min:()=>vr,mul:()=>Fr,multiply:()=>U,negate:()=>wr,normalize:()=>_r,random:()=>zr,rotate:()=>Yr,round:()=>ur,scale:()=>yr,scaleAndAdd:()=>Ar,set:()=>pr,signedAngle:()=>Cr,sqrDist:()=>Br,sqrLen:()=>Xr,squaredDistance:()=>tt,squaredLength:()=>et,str:()=>Vr,sub:()=>kr,subtract:()=>K,transformMat2:()=>Pr,transformMat2d:()=>br,transformMat3:()=>Ir,transformMat4:()=>Lr,zero:()=>Or});function Q(){var t=new u(2);return u!=Float32Array&&(t[0]=0,t[1]=0),t}function hr(t){var r=new u(2);return r[0]=t[0],r[1]=t[1],r}function xr(t,r){var e=new u(2);return e[0]=t,e[1]=r,e}function fr(t,r){return t[0]=r[0],t[1]=r[1],t}function pr(t,r,e){return t[0]=r,t[1]=e,t}function mr(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t}function K(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t}function U(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t}function Z(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t}function dr(t,r){return t[0]=Math.ceil(r[0]),t[1]=Math.ceil(r[1]),t}function Mr(t,r){return t[0]=Math.floor(r[0]),t[1]=Math.floor(r[1]),t}function vr(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t}function gr(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t}function ur(t,r){return t[0]=_(r[0]),t[1]=_(r[1]),t}function yr(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t}function Ar(t,r,e,n){return t[0]=r[0]+e[0]*n,t[1]=r[1]+e[1]*n,t}function $(t,r){var e=r[0]-t[0],n=r[1]-t[1];return Math.sqrt(e*e+n*n)}function tt(t,r){var e=r[0]-t[0],n=r[1]-t[1];return e*e+n*n}function rt(t){var r=t[0],e=t[1];return Math.sqrt(r*r+e*e)}function et(t){var r=t[0],e=t[1];return r*r+e*e}function wr(t,r){return t[0]=-r[0],t[1]=-r[1],t}function Sr(t,r){return t[0]=1/r[0],t[1]=1/r[1],t}function _r(t,r){var e=r[0],n=r[1],a=e*e+n*n;return a>0&&(a=1/Math.sqrt(a)),t[0]=r[0]*a,t[1]=r[1]*a,t}function Er(t,r){return t[0]*r[0]+t[1]*r[1]}function Tr(t,r,e){var n=r[0]*e[1]-r[1]*e[0];return t[0]=t[1]=0,t[2]=n,t}function Rr(t,r,e,n){var a=r[0],i=r[1];return t[0]=a+n*(e[0]-a),t[1]=i+n*(e[1]-i),t}function zr(t,r){r=r===void 0?1:r;var e=R()*2*Math.PI;return t[0]=Math.cos(e)*r,t[1]=Math.sin(e)*r,t}function Pr(t,r,e){var n=r[0],a=r[1];return t[0]=e[0]*n+e[2]*a,t[1]=e[1]*n+e[3]*a,t}function br(t,r,e){var n=r[0],a=r[1];return t[0]=e[0]*n+e[2]*a+e[4],t[1]=e[1]*n+e[3]*a+e[5],t}function Ir(t,r,e){var n=r[0],a=r[1];return t[0]=e[0]*n+e[3]*a+e[6],t[1]=e[1]*n+e[4]*a+e[7],t}function Lr(t,r,e){var n=r[0],a=r[1];return t[0]=e[0]*n+e[4]*a+e[12],t[1]=e[1]*n+e[5]*a+e[13],t}function Yr(t,r,e,n){var a=r[0]-e[0],i=r[1]-e[1],s=Math.sin(n),c=Math.cos(n);return t[0]=a*c-i*s+e[0],t[1]=a*s+i*c+e[1],t}function qr(t,r){var e=t[0],n=t[1],a=r[0],i=r[1];return Math.abs(Math.atan2(n*a-e*i,e*a+n*i))}function Cr(t,r){var e=t[0],n=t[1],a=r[0],i=r[1];return Math.atan2(e*i-n*a,e*a+n*i)}function Or(t){return t[0]=0,t[1]=0,t}function Vr(t){return"vec2("+t[0]+", "+t[1]+")"}function jr(t,r){return t[0]===r[0]&&t[1]===r[1]}function Nr(t,r){var e=t[0],n=t[1],a=r[0],i=r[1];return Math.abs(e-a)<=g*Math.max(1,Math.abs(e),Math.abs(a))&&Math.abs(n-i)<=g*Math.max(1,Math.abs(n),Math.abs(i))}var Dr=rt,kr=K,Fr=U,Hr=Z,Wr=$,Br=tt,Xr=et,Gr=(function(){var t=Q();return function(r,e,n,a,i,s){var c,l;for(e||(e=2),n||(n=0),a?l=Math.min(a*e+n,r.length):l=r.length,c=n;c<l;c+=e)t[0]=r[c],t[1]=r[c+1],i(t,t,s),r[c]=t[0],r[c+1]=t[1];return r}})();function Jr(t,r){let e=t[0],n=t[1],a=r[0],i=r[1];return Math.atan2(e*i-n*a,e*a+n*i)}var Y=class t{constructor(r,e,n){this.translation=o.create(),this.zoom=1,this.rotation=0,this.translation=r||this.translation,this.zoom=e||this.zoom,this.rotation=n||this.rotation}translationMatrix(){return y.fromTranslation(y.create(),this.translation)}scalingMatrix(){return y.fromScaling(y.create(),[this.zoom,this.zoom])}rotationMatrix(){return y.fromRotation(y.create(),this.rotation)}matrix(){let r=y.create();return y.mul(r,this.translationMatrix(),this.scalingMatrix()),y.mul(r,r,this.rotationMatrix()),r}translate(r){o.add(this.translation,this.translation,r)}zoomInto(r,e){this.zoom*=e,o.sub(this.translation,this.translation,r),o.scaleAndAdd(this.translation,r,this.translation,e)}rotateAround(r,e){this.rotation+=e,o.rotate(this.translation,this.translation,r,e)}lerp(r,e){o.lerp(this.translation,this.translation,r.translation,e),this.zoom=(1-e)*this.zoom+e*r.zoom,this.rotation=(1-e)*this.rotation+e*r.rotation}copy(r){o.copy(this.translation,r.translation),this.zoom=r.zoom,this.rotation=r.rotation}apply(r){return o.transformMat2d(r,r,this.matrix())}inverse(){let r=o.negate(o.create(),this.translation);return o.scale(r,r,1/this.zoom),o.rotate(r,r,o.create(),-this.rotation),new t(r,1/this.zoom,-this.rotation)}},b=class{constructor(r){this._listeners=[],this.config={scroll_sensitivity:1.01,rotation_sensitivity:.01,damping_strength:0,panning:!0,zooming:!0,rotating:!0};let e=r instanceof HTMLCanvasElement?r.getContext("2d"):r;if(e===null)throw new Error("Failed to get CanvasRenderingContext2D");this.ctx=e,this.transform=new Y,this.target_transform=new Y,this.canvas.style.touchAction="none",Qr(this,this.canvas)}updateDamping(r,e=!0){this.transform.lerp(this.target_transform,1-Math.exp(-r/this.config.damping_strength)),e&&this.updateTransform()}updateTransform(){this.config.damping_strength===0&&this.transform.copy(this.target_transform),this.ctx.resetTransform(),this.ctx.translate(...this.transform.translation),this.ctx.rotate(this.transform.rotation),this.ctx.scale(this.transform.zoom,this.transform.zoom),this._listeners.forEach(r=>r(this))}renderSpaceToScreen(r){return this.transform.apply(r)}screenToRenderSpace(r){return this.transform.inverse().apply(r)}getScreenAABB(){let r=[o.fromValues(0,0),o.fromValues(0,this.canvas.height),o.fromValues(this.canvas.width,0),o.fromValues(this.canvas.width,this.canvas.height)].map(this.screenToRenderSpace.bind(this)),e=r.map(a=>a[0]),n=r.map(a=>a[1]);return[o.fromValues(Math.min(...e),Math.min(...n)),o.fromValues(Math.max(...e),Math.max(...n))]}translate(r){this.target_transform.translate(r)}zoomInto(r,e){this.target_transform.zoomInto(r,e)}rotateAround(r,e){this.target_transform.rotateAround(r,e)}lerp(r,e){this.target_transform.lerp(r,e)}addListener(r){this._listeners.push(r)}removeListener(r){this._listeners.splice(this._listeners.indexOf(r),1)}clearScreen(){this.ctx.save(),this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()}get canvas(){return this.ctx.canvas}get listeners(){return this._listeners.slice()}};function Qr(t,r){let e={};r.addEventListener("contextmenu",n=>n.preventDefault()),r.addEventListener("pointerdown",n=>{e[n.pointerId]={pos:o.fromValues(n.offsetX,n.offsetY),button:n.button}}),r.addEventListener("pointerup",n=>{delete e[n.pointerId]}),r.addEventListener("pointermove",n=>{let a=e[n.pointerId];if(!a)return;let i=o.clone(a.pos);switch(o.set(a.pos,n.offsetX,n.offsetY),Object.keys(e).length){case 1:a.button===2&&t.config.rotating&&t.rotateAround([r.width/2,r.height/2],t.config.rotation_sensitivity*(a.pos[0]-i[0])),a.button==0&&t.config.panning&&t.translate(o.sub(o.create(),a.pos,i)),t.updateTransform();break;case 2:let s=Object.values(e).find(f=>f!==a);if(s===void 0)throw new Error("something is really wrong bro, good luck debugging ts");let c=o.add(o.create(),a.pos,s.pos);o.scale(c,c,.5);let l=o.sub(o.create(),a.pos,s.pos),h=o.sub(o.create(),i,s.pos);if(t.config.panning){let f=o.sub(o.create(),a.pos,i);t.translate(o.scale(f,f,.5))}t.config.zooming&&t.zoomInto(c,o.len(l)/o.len(h)),t.config.rotating&&t.rotateAround(c,Jr(h,l)),t.updateTransform();break}}),r.addEventListener("wheel",n=>{if(!t.config.zooming)return;let a=Math.pow(t.config.scroll_sensitivity,-n.deltaY);t.zoomInto([n.offsetX,n.offsetY],a),t.updateTransform(),n.preventDefault()},{passive:!1})}var E=class{constructor(r,e,n=1,a="black"){this.pos=r;this.vel=e;this.mass=n;this.color=a}render(r){r.ctx.fillStyle=this.color,r.ctx.beginPath(),r.ctx.arc(this.pos[0],this.pos[1],.01*Math.cbrt(this.mass),0,2*Math.PI),r.ctx.fill()}step(r){let e=l=>{let h=nt(o.fromValues(l[0],l[1]));return p.fromValues(l[2],l[3],h[0],h[1])},n=p.fromValues(this.pos[0],this.pos[1],this.vel[0],this.vel[1]),a=e(n),i=e(p.add(p.create(),n,p.scale(p.create(),a,r/2))),s=e(p.add(p.create(),n,p.scale(p.create(),i,r/2))),c=e(p.add(p.create(),n,p.scale(p.create(),s,r)));p.scale(a,a,r/6),p.scale(i,i,r/3),p.scale(s,s,r/3),p.scale(c,c,r/6),p.add(n,n,p.add(p.create(),p.add(p.create(),a,i),p.add(p.create(),s,c))),this.pos=o.fromValues(n[0],n[1]),this.vel=o.fromValues(n[2],n[3])}getTrajectory(r=.001){let e=this.pos[0]*this.vel[1]-this.pos[1]*this.vel[0],n=o.subtract(o.create(),o.fromValues(e*this.vel[1]/I,-e*this.vel[0]/I),o.normalize(o.create(),this.pos)),a=e*e/I,i=[];for(let s=-Math.PI;s<Math.PI;s+=r){let c=a/(1+o.len(n)*Math.cos(s-Math.atan2(n[1],n[0])));c<0||i.push(o.fromValues(c*Math.cos(s),c*Math.sin(s)))}return i}renderTrajectory(r){let e=this.getTrajectory();r.ctx.strokeStyle=this.color,r.ctx.lineWidth=1/r.transform.zoom,r.ctx.beginPath(),r.ctx.moveTo(e[0][0],e[0][1]);for(let n=1;n<e.length;n++)r.ctx.lineTo(e[n][0],e[n][1]);r.ctx.stroke()}};var q=class{},z=class extends q{constructor(e=new E(o.fromValues(.5,0),o.fromValues(0,-.09),1,"red")){super();this.m=e}tick(e,n){n=Math.min(n,.01),e.clearScreen(),e.ctx.fillStyle="rgb(224, 224, 0)",e.ctx.beginPath(),e.ctx.arc(0,0,.04,0,2*Math.PI),e.ctx.fill();let a=performance.now();for(let i=0;i<n/A&&performance.now()-a<100;i++)n/A-i<1?this.m.step(n-i*A):this.m.step(A);this.m.render(e),this.m.renderTrajectory(e)}},L=class extends q{constructor(e,n){super();this.m1=e;this.m2=n}last_CM=null;CM_trajectory_ctx=document.getElementById("trajectory-canvas").getContext("2d");tick(e,n){n=Math.min(n,.1),e.clearScreen(),e.ctx.fillStyle="rgb(224, 224, 0)",e.ctx.beginPath(),e.ctx.arc(0,0,.04,0,2*Math.PI),e.ctx.fill();for(let l=0;l<n/A;l++)n/A-l<1?(this.m1.step(n-l*A),this.m2.step(n-l*A)):(this.m1.step(A),this.m2.step(A));this.m1.render(e),this.m1.renderTrajectory(e),this.m2.render(e),this.m2.renderTrajectory(e);let a=this.m1.mass+this.m2.mass,i=o.add(o.create(),o.scale(o.create(),this.m1.pos,this.m1.mass/a),o.scale(o.create(),this.m2.pos,this.m2.mass/a));e.ctx.fillStyle="black",e.ctx.beginPath(),e.ctx.arc(i[0],i[1],.005,0,2*Math.PI),e.ctx.fill(),this.CM_trajectory_ctx.strokeStyle="black",this.CM_trajectory_ctx.lineWidth=1;let s=e.renderSpaceToScreen(this.last_CM?o.clone(this.last_CM):o.clone(i)),c=e.renderSpaceToScreen(o.clone(i));this.CM_trajectory_ctx.beginPath(),this.CM_trajectory_ctx.moveTo(s[0],s[1]),this.CM_trajectory_ctx.lineTo(c[0],c[1]),this.CM_trajectory_ctx.stroke(),this.last_CM=i}};var P=document.getElementById("canvas"),at=document.getElementById("trajectory-canvas"),x=new b(P);x.config.panning=!1;x.config.zooming=!1;x.config.rotating=!1;x.zoomInto(o.create(),window.innerWidth/2);x.translate(o.fromValues(window.innerWidth/2,window.innerHeight/2));x.updateTransform();function it(){P.width=window.innerWidth,P.height=window.innerHeight,at.width=window.innerWidth,at.height=window.innerHeight,x.updateTransform()}window.addEventListener("resize",it);it();var I=.01;function nt(t){return o.scale(o.create(),t,-I/Math.pow(o.len(t),3))}var A=1e-4,d=new z,T=d.m.getTrajectory(),m=T[4075],w=o.fromValues(0,-.15);(()=>{let t=!1,r=!1;P.addEventListener("pointerdown",e=>{if(e.button!==0)return;let n=x.screenToRenderSpace(o.fromValues(e.clientX,e.clientY));o.distance(n,o.add(o.create(),m,w))<.1?t=!0:o.distance(n,m)<.1&&(r=!0)}),P.addEventListener("pointermove",e=>{let n=x.screenToRenderSpace(o.fromValues(e.clientX,e.clientY));if(t)o.subtract(w,n,m);else if(r){let a=0,i=o.distance(n,T[0]);for(let s=1;s<T.length;s++){let c=o.distance(n,T[s]);c<i&&(a=s,i=c)}m=T[a]}}),P.addEventListener("pointerup",()=>{t=!1,r=!1})})();var V=0;function ot(t){if(d.tick(x,(t-V)/1e3),d instanceof z&&o.distance(d.m.pos,m)<.01&&o.dot(d.m.vel,o.subtract(o.create(),d.m.pos,m))<0){let r=new E(o.clone(d.m.pos),o.add(o.create(),d.m.vel,o.scale(o.create(),w,.1/(d.m.mass*.8))),d.m.mass*.8,"rgba(0, 255, 0, 0.4)"),e=new E(o.clone(d.m.pos),o.add(o.create(),d.m.vel,o.scale(o.create(),w,-.1/(d.m.mass*.2))),d.m.mass*.2,"rgba(0, 0, 255, 0.4)");d=new L(r,e)}if(d instanceof L){x.ctx.strokeStyle="rgba(255, 0, 0, 0.8)",x.ctx.lineWidth=1/x.transform.zoom,x.ctx.beginPath(),x.ctx.moveTo(T[0][0],T[0][1]);for(let r of T)x.ctx.lineTo(r[0],r[1]);x.ctx.stroke()}if(d instanceof z){x.ctx.fillStyle="grey",x.ctx.beginPath(),x.ctx.arc(m[0],m[1],.01,0,2*Math.PI),x.ctx.fill(),x.ctx.strokeStyle="grey",x.ctx.lineCap="round",x.ctx.lineJoin="round",x.ctx.lineWidth=3/x.transform.zoom,x.ctx.beginPath(),x.ctx.moveTo(m[0],m[1]),x.ctx.lineTo(m[0]+w[0],m[1]+w[1]);let r=o.scale(o.create(),o.rotate(o.create(),w,o.create(),Math.PI/24),.87),e=o.scale(o.create(),o.rotate(o.create(),w,o.create(),-Math.PI/24),.87);x.ctx.lineTo(m[0]+r[0],m[1]+r[1]),x.ctx.moveTo(m[0]+w[0],m[1]+w[1]),x.ctx.lineTo(m[0]+e[0],m[1]+e[1]),x.ctx.stroke()}V=t,requestAnimationFrame(ot)}requestAnimationFrame(t=>{V=t,requestAnimationFrame(ot)});export{I as GM,A as dt,nt as gravity};
