function v(t){t.fillStyle="white",t.beginPath(),t.arc(t.canvas.width/2,t.canvas.height/2,10,0,2*Math.PI),t.fill()}var e=document.getElementById("canvas"),n=e.getContext("2d");function p(){e.width=window.innerWidth,e.height=window.innerHeight}window.addEventListener("resize",p);p();v(n);await new Promise(t=>setTimeout(t,1e3));var r=n.getImageData(0,0,e.width,e.height),I=100,m=5,d=1e5,l=new Float32Array(e.width*e.height),s=new Float32Array(e.width*e.height),f=1,R=!0;n.fillStyle="white";n.fillRect(0,0,e.width,e.height);var g=n.getImageData(0,0,e.width,e.height),y=0;for(let t=0;t<r.data.length/4;t++)r.data[4*t+3]!==0&&y++;var u=0;for(let t=0;t<r.data.length/4;t++){let h=r.data[4*t+3];if(h===0)continue;u++;let w=t%r.width,b=Math.floor(t/r.width);for(let i=0;i<e.width;i++)for(let a=0;a<e.height;a++){let o=Math.hypot(I,i-e.width/2+w/d,a-e.height/2+b/d);l[i+a*e.width]+=h*Math.cos(2*Math.PI*d*o/m),s[i+a*e.width]+=h*Math.sin(2*Math.PI*d*o/m)}if(t%10===0){let i=0;for(let a=0;a<l.length;a++){let o=(l[a]*l[a]+s[a]*s[a])/255,c=o<=.003108?12.92*o:Math.pow(o,1/2.4)*1.055-.055;g.data[4*a+3]=f*c,c>i&&(i=c)}R&&(f=255/i),n.putImageData(g,0,0),n.fillStyle="red",n.fillRect(0,0,e.width*(1-u/y),10),await new Promise(a=>setTimeout(a,0))}}for(let t=0;t<l.length;t++){let h=(l[t]*l[t]+s[t]*s[t])/255,w=h<=.003108?12.92*h:Math.pow(h,1/2.4)*1.055-.055;g.data[4*t+3]=f*w}n.putImageData(g,0,0);alert("done");
