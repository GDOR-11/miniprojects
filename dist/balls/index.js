var K=Object.defineProperty;var S=(t,r)=>{for(var e in r)K(t,e,{get:r[e],enumerable:!0})};var u=1e-6,v=typeof Float32Array<"u"?Float32Array:Array,V=Math.random;var lr=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});var x={};S(x,{add:()=>pt,clone:()=>U,copy:()=>Z,create:()=>Q,determinant:()=>it,equals:()=>vt,exactEquals:()=>ut,frob:()=>mt,fromRotation:()=>lt,fromScaling:()=>ht,fromTranslation:()=>ct,fromValues:()=>rt,identity:()=>tt,invert:()=>nt,mul:()=>Mt,multiply:()=>L,multiplyScalar:()=>dt,multiplyScalarAndAdd:()=>xt,rotate:()=>ot,scale:()=>at,set:()=>et,str:()=>ft,sub:()=>gt,subtract:()=>Y,translate:()=>st});function Q(){var t=new v(6);return v!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function U(t){var r=new v(6);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function Z(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t}function tt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function rt(t,r,e,n,i,a){var s=new v(6);return s[0]=t,s[1]=r,s[2]=e,s[3]=n,s[4]=i,s[5]=a,s}function et(t,r,e,n,i,a,s){return t[0]=r,t[1]=e,t[2]=n,t[3]=i,t[4]=a,t[5]=s,t}function nt(t,r){var e=r[0],n=r[1],i=r[2],a=r[3],s=r[4],l=r[5],h=e*a-n*i;return h?(h=1/h,t[0]=a*h,t[1]=-n*h,t[2]=-i*h,t[3]=e*h,t[4]=(i*l-a*s)*h,t[5]=(n*s-e*l)*h,t):null}function it(t){return t[0]*t[3]-t[1]*t[2]}function L(t,r,e){var n=r[0],i=r[1],a=r[2],s=r[3],l=r[4],h=r[5],c=e[0],f=e[1],A=e[2],y=e[3],_=e[4],T=e[5];return t[0]=n*c+a*f,t[1]=i*c+s*f,t[2]=n*A+a*y,t[3]=i*A+s*y,t[4]=n*_+a*T+l,t[5]=i*_+s*T+h,t}function ot(t,r,e){var n=r[0],i=r[1],a=r[2],s=r[3],l=r[4],h=r[5],c=Math.sin(e),f=Math.cos(e);return t[0]=n*f+a*c,t[1]=i*f+s*c,t[2]=n*-c+a*f,t[3]=i*-c+s*f,t[4]=l,t[5]=h,t}function at(t,r,e){var n=r[0],i=r[1],a=r[2],s=r[3],l=r[4],h=r[5],c=e[0],f=e[1];return t[0]=n*c,t[1]=i*c,t[2]=a*f,t[3]=s*f,t[4]=l,t[5]=h,t}function st(t,r,e){var n=r[0],i=r[1],a=r[2],s=r[3],l=r[4],h=r[5],c=e[0],f=e[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=s,t[4]=n*c+a*f+l,t[5]=i*c+s*f+h,t}function lt(t,r){var e=Math.sin(r),n=Math.cos(r);return t[0]=n,t[1]=e,t[2]=-e,t[3]=n,t[4]=0,t[5]=0,t}function ht(t,r){return t[0]=r[0],t[1]=0,t[2]=0,t[3]=r[1],t[4]=0,t[5]=0,t}function ct(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=r[0],t[5]=r[1],t}function ft(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function mt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function pt(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t[2]=r[2]+e[2],t[3]=r[3]+e[3],t[4]=r[4]+e[4],t[5]=r[5]+e[5],t}function Y(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t[3]=r[3]-e[3],t[4]=r[4]-e[4],t[5]=r[5]-e[5],t}function dt(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t[2]=r[2]*e,t[3]=r[3]*e,t[4]=r[4]*e,t[5]=r[5]*e,t}function xt(t,r,e,n){return t[0]=r[0]+e[0]*n,t[1]=r[1]+e[1]*n,t[2]=r[2]+e[2]*n,t[3]=r[3]+e[3]*n,t[4]=r[4]+e[4]*n,t[5]=r[5]+e[5]*n,t}function ut(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]}function vt(t,r){var e=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],h=r[0],c=r[1],f=r[2],A=r[3],y=r[4],_=r[5];return Math.abs(e-h)<=u*Math.max(1,Math.abs(e),Math.abs(h))&&Math.abs(n-c)<=u*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-f)<=u*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-A)<=u*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(s-y)<=u*Math.max(1,Math.abs(s),Math.abs(y))&&Math.abs(l-_)<=u*Math.max(1,Math.abs(l),Math.abs(_))}var Mt=L,gt=Y;var o={};S(o,{add:()=>wt,angle:()=>Ht,ceil:()=>Et,clone:()=>At,copy:()=>_t,create:()=>q,cross:()=>Nt,dist:()=>Zt,distance:()=>D,div:()=>Ut,divide:()=>O,dot:()=>qt,equals:()=>$t,exactEquals:()=>Xt,floor:()=>zt,forEach:()=>er,fromValues:()=>yt,inverse:()=>Lt,len:()=>Jt,length:()=>W,lerp:()=>Bt,max:()=>Pt,min:()=>Rt,mul:()=>Qt,multiply:()=>B,negate:()=>It,normalize:()=>Yt,random:()=>Ot,rotate:()=>Ct,round:()=>Tt,scale:()=>St,scaleAndAdd:()=>Vt,set:()=>bt,sqrDist:()=>tr,sqrLen:()=>rr,squaredDistance:()=>F,squaredLength:()=>k,str:()=>Gt,sub:()=>Kt,subtract:()=>N,transformMat2:()=>Dt,transformMat2d:()=>Ft,transformMat3:()=>Wt,transformMat4:()=>kt,zero:()=>jt});function q(){var t=new v(2);return v!=Float32Array&&(t[0]=0,t[1]=0),t}function At(t){var r=new v(2);return r[0]=t[0],r[1]=t[1],r}function yt(t,r){var e=new v(2);return e[0]=t,e[1]=r,e}function _t(t,r){return t[0]=r[0],t[1]=r[1],t}function bt(t,r,e){return t[0]=r,t[1]=e,t}function wt(t,r,e){return t[0]=r[0]+e[0],t[1]=r[1]+e[1],t}function N(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t}function B(t,r,e){return t[0]=r[0]*e[0],t[1]=r[1]*e[1],t}function O(t,r,e){return t[0]=r[0]/e[0],t[1]=r[1]/e[1],t}function Et(t,r){return t[0]=Math.ceil(r[0]),t[1]=Math.ceil(r[1]),t}function zt(t,r){return t[0]=Math.floor(r[0]),t[1]=Math.floor(r[1]),t}function Rt(t,r,e){return t[0]=Math.min(r[0],e[0]),t[1]=Math.min(r[1],e[1]),t}function Pt(t,r,e){return t[0]=Math.max(r[0],e[0]),t[1]=Math.max(r[1],e[1]),t}function Tt(t,r){return t[0]=Math.round(r[0]),t[1]=Math.round(r[1]),t}function St(t,r,e){return t[0]=r[0]*e,t[1]=r[1]*e,t}function Vt(t,r,e,n){return t[0]=r[0]+e[0]*n,t[1]=r[1]+e[1]*n,t}function D(t,r){var e=r[0]-t[0],n=r[1]-t[1];return Math.hypot(e,n)}function F(t,r){var e=r[0]-t[0],n=r[1]-t[1];return e*e+n*n}function W(t){var r=t[0],e=t[1];return Math.hypot(r,e)}function k(t){var r=t[0],e=t[1];return r*r+e*e}function It(t,r){return t[0]=-r[0],t[1]=-r[1],t}function Lt(t,r){return t[0]=1/r[0],t[1]=1/r[1],t}function Yt(t,r){var e=r[0],n=r[1],i=e*e+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=r[0]*i,t[1]=r[1]*i,t}function qt(t,r){return t[0]*r[0]+t[1]*r[1]}function Nt(t,r,e){var n=r[0]*e[1]-r[1]*e[0];return t[0]=t[1]=0,t[2]=n,t}function Bt(t,r,e,n){var i=r[0],a=r[1];return t[0]=i+n*(e[0]-i),t[1]=a+n*(e[1]-a),t}function Ot(t,r){r=r||1;var e=V()*2*Math.PI;return t[0]=Math.cos(e)*r,t[1]=Math.sin(e)*r,t}function Dt(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i,t[1]=e[1]*n+e[3]*i,t}function Ft(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[2]*i+e[4],t[1]=e[1]*n+e[3]*i+e[5],t}function Wt(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[3]*i+e[6],t[1]=e[1]*n+e[4]*i+e[7],t}function kt(t,r,e){var n=r[0],i=r[1];return t[0]=e[0]*n+e[4]*i+e[12],t[1]=e[1]*n+e[5]*i+e[13],t}function Ct(t,r,e,n){var i=r[0]-e[0],a=r[1]-e[1],s=Math.sin(n),l=Math.cos(n);return t[0]=i*l-a*s+e[0],t[1]=i*s+a*l+e[1],t}function Ht(t,r){var e=t[0],n=t[1],i=r[0],a=r[1],s=Math.sqrt(e*e+n*n)*Math.sqrt(i*i+a*a),l=s&&(e*i+n*a)/s;return Math.acos(Math.min(Math.max(l,-1),1))}function jt(t){return t[0]=0,t[1]=0,t}function Gt(t){return"vec2("+t[0]+", "+t[1]+")"}function Xt(t,r){return t[0]===r[0]&&t[1]===r[1]}function $t(t,r){var e=t[0],n=t[1],i=r[0],a=r[1];return Math.abs(e-i)<=u*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(n-a)<=u*Math.max(1,Math.abs(n),Math.abs(a))}var Jt=W,Kt=N,Qt=B,Ut=O,Zt=D,tr=F,rr=k,er=function(){var t=q();return function(r,e,n,i,a,s){var l,h;for(e||(e=2),n||(n=0),i?h=Math.min(i*e+n,r.length):h=r.length,l=n;l<h;l+=e)t[0]=r[l],t[1]=r[l+1],a(t,t,s),r[l]=t[0],r[l+1]=t[1];return r}}();function nr(t,r){let e=t[0],n=t[1],i=r[0],a=r[1];return Math.atan2(e*a-n*i,e*i+n*a)}var E=class t{constructor(r,e,n){this.translation=o.create(),this.zoom=1,this.rotation=0,this.translation=r||this.translation,this.zoom=e||this.zoom,this.rotation=n||this.rotation}translationMatrix(){return x.fromTranslation(x.create(),this.translation)}scalingMatrix(){return x.fromScaling(x.create(),[this.zoom,this.zoom])}rotationMatrix(){return x.fromRotation(x.create(),this.rotation)}matrix(){let r=x.create();return x.mul(r,this.translationMatrix(),this.scalingMatrix()),x.mul(r,r,this.rotationMatrix()),r}translate(r){o.add(this.translation,this.translation,r)}zoomInto(r,e){this.zoom*=e,o.sub(this.translation,this.translation,r),o.scaleAndAdd(this.translation,r,this.translation,e)}rotateAround(r,e){this.rotation+=e,o.rotate(this.translation,this.translation,r,e)}lerp(r,e){o.lerp(this.translation,this.translation,r.translation,e),this.zoom=(1-e)*this.zoom+e*r.zoom,this.rotation=(1-e)*this.rotation+e*r.rotation}copy(r){o.copy(this.translation,r.translation),this.zoom=r.zoom,this.rotation=r.rotation}apply(r){return o.transformMat2d(r,r,this.matrix())}inverse(){let r=o.negate(o.create(),this.translation);return o.scale(r,r,1/this.zoom),o.rotate(r,r,o.create(),-this.rotation),new t(r,1/this.zoom,-this.rotation)}},b=class{constructor(r){this._listeners=[],this.config={scroll_sensitivity:1.01,rotation_sensitivity:.01,damping_strength:0,panning:!0,zooming:!0,rotating:!0};let e=r instanceof HTMLCanvasElement?r.getContext("2d"):r;if(e===null)throw new Error("Failed to get CanvasRenderingContext2D");this.ctx=e,this.transform=new E,this.target_transform=new E,this.canvas.style.touchAction="none",ir(this,this.canvas)}updateDamping(r,e=!0){this.transform.lerp(this.target_transform,1-Math.exp(-r/this.config.damping_strength)),e&&this.updateTransform()}updateTransform(){this.config.damping_strength===0&&this.transform.copy(this.target_transform),this.ctx.resetTransform(),this.ctx.translate(...this.transform.translation),this.ctx.rotate(this.transform.rotation),this.ctx.scale(this.transform.zoom,this.transform.zoom),this._listeners.forEach(r=>r(this))}renderSpaceToScreen(r){return this.transform.apply(r)}screenToRenderSpace(r){return this.transform.inverse().apply(r)}getScreenAABB(){let r=[o.fromValues(0,0),o.fromValues(0,this.canvas.height),o.fromValues(this.canvas.width,0),o.fromValues(this.canvas.width,this.canvas.height)].map(this.screenToRenderSpace.bind(this)),e=r.map(i=>i[0]),n=r.map(i=>i[1]);return[o.fromValues(Math.min(...e),Math.min(...n)),o.fromValues(Math.max(...e),Math.max(...n))]}translate(r){this.target_transform.translate(r)}zoomInto(r,e){this.target_transform.zoomInto(r,e)}rotateAround(r,e){this.target_transform.rotateAround(r,e)}lerp(r,e){this.target_transform.lerp(r,e)}addListener(r){this._listeners.push(r)}removeListener(r){this._listeners.splice(this._listeners.indexOf(r),1)}clearScreen(){this.ctx.save(),this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()}get canvas(){return this.ctx.canvas}get listeners(){return this._listeners.slice()}};function ir(t,r){let e={};r.addEventListener("contextmenu",n=>n.preventDefault()),r.addEventListener("pointerdown",n=>{e[n.pointerId]={pos:o.fromValues(n.offsetX,n.offsetY),button:n.button}}),r.addEventListener("pointerup",n=>{delete e[n.pointerId]}),r.addEventListener("pointermove",n=>{let i=e[n.pointerId];if(!i)return;let a=o.clone(i.pos);switch(o.set(i.pos,n.offsetX,n.offsetY),Object.keys(e).length){case 1:i.button===2&&t.config.rotating&&t.rotateAround([r.width/2,r.height/2],t.config.rotation_sensitivity*(i.pos[0]-a[0])),i.button==0&&t.config.panning&&t.translate(o.sub(o.create(),i.pos,a)),t.updateTransform();break;case 2:let s=Object.values(e).find(f=>f!==i);if(s===void 0)throw new Error("something is really wrong bro, good luck debugging ts");let l=o.add(o.create(),i.pos,s.pos);o.scale(l,l,.5);let h=o.sub(o.create(),i.pos,s.pos),c=o.sub(o.create(),a,s.pos);if(t.config.panning){let f=o.sub(o.create(),i.pos,a);t.translate(o.scale(f,f,.5))}t.config.zooming&&t.zoomInto(l,o.len(h)/o.len(c)),t.config.rotating&&t.rotateAround(l,nr(c,h)),t.updateTransform();break}}),r.addEventListener("wheel",n=>{if(!t.config.zooming)return;let i=Math.pow(t.config.scroll_sensitivity,-n.deltaY);t.zoomInto([n.offsetX,n.offsetY],i),t.updateTransform(),n.preventDefault()},{passive:!1})}var g=class{radius;pos;vel;mass;color;constructor(r,e=o.fromValues(0,0),n=o.fromValues(0,0),i=1,a="white"){this.radius=r,this.pos=e,this.vel=n,this.mass=i,this.color=a}getPosition(r,e){return o.scaleAndAdd(r,this.pos,this.vel,e),o.scaleAndAdd(r,r,m,e*e/2),r}step(r){this.getPosition(this.pos,r),o.scaleAndAdd(this.vel,this.vel,m,r)}getAABB(r){let e=this.pos,n=this.getPosition(o.create(),r),i=[o.fromValues(Math.min(e[0],n[0]),Math.min(e[1],n[1])),o.fromValues(Math.max(e[0],n[0]),Math.max(e[1],n[1]))],a=o.fromValues(-this.vel[0]/m[0],-this.vel[1]/m[1]);if(0<=a[0]&&a[0]<=r){let s=this.pos[0]-this.vel[0]**2/(2*m[0]);m[0]>0?i[0][0]=s:m[0]<0&&(i[1][0]=s)}if(0<=a[1]&&a[1]<=r){let s=this.pos[1]-this.vel[1]**2/(2*m[1]);m[1]>0?i[0][1]=s:m[1]<0&&(i[1][1]=s)}return i[0][0]-=this.radius,i[0][1]-=this.radius,i[1][0]+=this.radius,i[1][1]+=this.radius,i}render({ctx:r}){r.fillStyle=this.color,r.beginPath(),r.arc(this.pos[0],this.pos[1],this.radius,0,2*Math.PI),r.fill()}};var M=class{A;B;constructor(r,e){this.A=r,this.B=e}render(r){let e=r.getScreenAABB(),n,i;Number.isFinite(this.A[0]/this.A[1])?(n=o.fromValues(e[0][0],(this.B-this.A[0]*e[0][0])/this.A[1]),i=o.fromValues(e[1][0],(this.B-this.A[0]*e[1][0])/this.A[1])):(n=o.fromValues((this.B-this.A[1]*e[0][1])/this.A[0],e[0][1]),i=o.fromValues((this.B-this.A[1]*e[1][1])/this.A[0],e[1][1])),r.ctx.strokeStyle="white",r.ctx.lineWidth=1/r.transform.zoom,r.ctx.beginPath(),r.ctx.moveTo(n[0],n[1]),r.ctx.lineTo(i[0],i[1]),r.ctx.stroke()}};function C(t,r){let e=o.sub(o.create(),t.pos,r.pos),n=o.sub(o.create(),t.vel,r.vel),i=o.dot(n,n),a=o.dot(n,e),s=o.dot(e,e)-(t.radius+r.radius)**2,l=-(a+Math.sqrt(a*a-i*s))/i;if(l<-z||isNaN(l))return 1/0;let h=o.sub(o.create(),t.getPosition(o.create(),l),r.getPosition(o.create(),l)),c=o.sub(o.create(),o.scaleAndAdd(o.create(),t.vel,m,l),o.scaleAndAdd(o.create(),r.vel,m,l));return o.dot(h,c)>0?1/0:l}function H(t,r){let e=1/0;for(let n of[[1,1],[1,-1],[-1,1],[-1,-1]]){let i=o.dot(r.A,m),a=o.dot(r.A,t.vel),s=o.dot(r.A,t.pos)-r.B+n[0]*t.radius*o.len(r.A),l=Math.abs(i)<z?-s/a:(-a+n[1]*Math.sqrt(a*a-2*i*s))/i;if(l<-z||isNaN(l)||e<=l)continue;let h=t.getPosition(o.create(),l),c=o.scaleAndAdd(o.create(),t.vel,m,l);o.dot(c,r.A)*(o.dot(h,r.A)-r.B)>0||(e=l)}return e}function j(t,r){let e=o.sub(o.create(),t.pos,r.pos),n=o.sub(o.create(),t.vel,r.vel);o.scaleAndAdd(t.vel,t.vel,e,-2*(r.mass/(t.mass+r.mass))*o.dot(n,e)/o.dot(e,e)),o.scaleAndAdd(r.vel,r.vel,e,2*(t.mass/(t.mass+r.mass))*o.dot(n,e)/o.dot(e,e))}function G(t,r){o.scaleAndAdd(t.vel,t.vel,r.A,-2*o.dot(t.vel,r.A)/o.dot(r.A,r.A))}var m=o.fromValues(0,20),z=1e-6,w=document.getElementById("canvas"),d=new b(w);d.config.panning=!1;d.config.zooming=!1;d.config.rotating=!1;function X(){w.width=window.innerWidth,w.height=window.innerHeight}window.addEventListener("resize",X);X();d.zoomInto(o.fromValues(0,0),10);d.translate(o.fromValues(w.width/2,w.height/2));d.updateTransform();var p=[];for(let t=-10;t<=10;t+=4)for(let r=-20;r<=20;r+=4)p.push(new g(1,o.fromValues(t,r),o.fromValues(0,0),1,`rgb(${255*Math.random()},${255*Math.random()},${255*Math.random()})`));p[0].pos[0]+=1e-6;var R=[new M(o.fromValues(0,1),.5*window.innerHeight/d.transform.zoom),new M(o.fromValues(0,1),-.5*window.innerHeight/d.transform.zoom),new M(o.fromValues(1,0),.5*window.innerWidth/d.transform.zoom),new M(o.fromValues(1,0),-.5*window.innerWidth/d.transform.zoom)];function $(t){let r=1/0,e=null;for(let i=0;i<p.length;i++)for(let a=i+1;a<p.length;a++){let s=C(p[i],p[a]);s<r&&(e=[p[i],p[a]],r=s)}for(let i=0;i<p.length;i++)for(let a=0;a<R.length;a++){let s=H(p[i],R[a]);s<r&&(e=[p[i],R[a]],r=s)}let n=Math.min(r,t);p.forEach(i=>i.step(n)),n!==t&&(e[1]instanceof g?j(e[0],e[1]):G(e[0],e[1]),$(t-n))}var P=0;function J(t){d.clearScreen(),p.forEach(r=>r.render(d)),R.forEach(r=>r.render(d)),$(Math.min(1e3,t-P)/1e3),P=t,requestAnimationFrame(J)}requestAnimationFrame(t=>{P=t,requestAnimationFrame(J)});export{z as DELTA,m as G};
