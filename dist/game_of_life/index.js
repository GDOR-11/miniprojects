var Z=Object.defineProperty;var k=(t,e)=>{for(var r in e)Z(t,r,{get:e[r],enumerable:!0})};var x=1e-6,g=typeof Float32Array<"u"?Float32Array:Array,q=Math.random;var de=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var u={};k(u,{add:()=>xt,clone:()=>et,copy:()=>rt,create:()=>tt,determinant:()=>st,equals:()=>yt,exactEquals:()=>vt,frob:()=>ut,fromRotation:()=>ht,fromScaling:()=>pt,fromTranslation:()=>mt,fromValues:()=>it,identity:()=>nt,invert:()=>ot,mul:()=>wt,multiply:()=>C,multiplyScalar:()=>gt,multiplyScalarAndAdd:()=>Mt,rotate:()=>lt,scale:()=>ct,set:()=>at,str:()=>dt,sub:()=>bt,subtract:()=>O,translate:()=>ft});function tt(){var t=new g(6);return g!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function et(t){var e=new g(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function rt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function nt(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function it(t,e,r,n,i,a){var o=new g(6);return o[0]=t,o[1]=e,o[2]=r,o[3]=n,o[4]=i,o[5]=a,o}function at(t,e,r,n,i,a,o){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=a,t[5]=o,t}function ot(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],c=r*a-n*i;return c?(c=1/c,t[0]=a*c,t[1]=-n*c,t[2]=-i*c,t[3]=r*c,t[4]=(i*s-a*o)*c,t[5]=(n*o-r*s)*c,t):null}function st(t){return t[0]*t[3]-t[1]*t[2]}function C(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],h=r[0],f=r[1],m=r[2],M=r[3],v=r[4],p=r[5];return t[0]=n*h+a*f,t[1]=i*h+o*f,t[2]=n*m+a*M,t[3]=i*m+o*M,t[4]=n*v+a*p+s,t[5]=i*v+o*p+c,t}function lt(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],h=Math.sin(r),f=Math.cos(r);return t[0]=n*f+a*h,t[1]=i*f+o*h,t[2]=n*-h+a*f,t[3]=i*-h+o*f,t[4]=s,t[5]=c,t}function ct(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],h=r[0],f=r[1];return t[0]=n*h,t[1]=i*h,t[2]=a*f,t[3]=o*f,t[4]=s,t[5]=c,t}function ft(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],c=e[5],h=r[0],f=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=n*h+a*f+s,t[5]=i*h+o*f+c,t}function ht(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t}function pt(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function mt(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function dt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function ut(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function xt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function O(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function gt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function Mt(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t}function vt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function yt(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],c=e[0],h=e[1],f=e[2],m=e[3],M=e[4],v=e[5];return Math.abs(r-c)<=x*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-h)<=x*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-f)<=x*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-m)<=x*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-M)<=x*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(s-v)<=x*Math.max(1,Math.abs(s),Math.abs(v))}var wt=C,bt=O;var l={};k(l,{add:()=>zt,angle:()=>$t,ceil:()=>It,clone:()=>Et,copy:()=>_t,create:()=>B,cross:()=>Bt,dist:()=>re,distance:()=>H,div:()=>ee,divide:()=>F,dot:()=>Ot,equals:()=>Qt,exactEquals:()=>Kt,floor:()=>Tt,forEach:()=>ae,fromValues:()=>At,inverse:()=>Nt,len:()=>Ut,length:()=>W,lerp:()=>Vt,max:()=>Lt,min:()=>Rt,mul:()=>te,multiply:()=>D,negate:()=>qt,normalize:()=>Ct,random:()=>Dt,rotate:()=>Xt,round:()=>Pt,scale:()=>Yt,scaleAndAdd:()=>kt,set:()=>St,sqrDist:()=>ne,sqrLen:()=>ie,squaredDistance:()=>j,squaredLength:()=>X,str:()=>Jt,sub:()=>Zt,subtract:()=>V,transformMat2:()=>Ft,transformMat2d:()=>Ht,transformMat3:()=>jt,transformMat4:()=>Wt,zero:()=>Gt});function B(){var t=new g(2);return g!=Float32Array&&(t[0]=0,t[1]=0),t}function Et(t){var e=new g(2);return e[0]=t[0],e[1]=t[1],e}function At(t,e){var r=new g(2);return r[0]=t,r[1]=e,r}function _t(t,e){return t[0]=e[0],t[1]=e[1],t}function St(t,e,r){return t[0]=e,t[1]=r,t}function zt(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function V(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function D(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function F(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function It(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Tt(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Rt(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function Lt(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function Pt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function Yt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function kt(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function H(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function j(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function W(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function X(t){var e=t[0],r=t[1];return e*e+r*r}function qt(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Nt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function Ct(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function Ot(t,e){return t[0]*e[0]+t[1]*e[1]}function Bt(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function Vt(t,e,r,n){var i=e[0],a=e[1];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t}function Dt(t,e){e=e||1;var r=q()*2*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function Ft(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t}function Ht(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t}function jt(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t}function Wt(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t}function Xt(t,e,r,n){var i=e[0]-r[0],a=e[1]-r[1],o=Math.sin(n),s=Math.cos(n);return t[0]=i*s-a*o+r[0],t[1]=i*o+a*s+r[1],t}function $t(t,e){var r=t[0],n=t[1],i=e[0],a=e[1],o=Math.sqrt(r*r+n*n)*Math.sqrt(i*i+a*a),s=o&&(r*i+n*a)/o;return Math.acos(Math.min(Math.max(s,-1),1))}function Gt(t){return t[0]=0,t[1]=0,t}function Jt(t){return"vec2("+t[0]+", "+t[1]+")"}function Kt(t,e){return t[0]===e[0]&&t[1]===e[1]}function Qt(t,e){var r=t[0],n=t[1],i=e[0],a=e[1];return Math.abs(r-i)<=x*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=x*Math.max(1,Math.abs(n),Math.abs(a))}var Ut=W,Zt=V,te=D,ee=F,re=H,ne=j,ie=X,ae=function(){var t=B();return function(e,r,n,i,a,o){var s,c;for(r||(r=2),n||(n=0),i?c=Math.min(i*r+n,e.length):c=e.length,s=n;s<c;s+=r)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}();function oe(t,e){let r=t[0],n=t[1],i=e[0],a=e[1];return Math.atan2(r*a-n*i,r*i+n*a)}var _=class t{constructor(e,r,n){this.translation=l.create(),this.zoom=1,this.rotation=0,this.translation=e||this.translation,this.zoom=r||this.zoom,this.rotation=n||this.rotation}translationMatrix(){return u.fromTranslation(u.create(),this.translation)}scalingMatrix(){return u.fromScaling(u.create(),[this.zoom,this.zoom])}rotationMatrix(){return u.fromRotation(u.create(),this.rotation)}matrix(){let e=u.create();return u.mul(e,this.translationMatrix(),this.scalingMatrix()),u.mul(e,e,this.rotationMatrix()),e}translate(e){l.add(this.translation,this.translation,e)}zoomInto(e,r){this.zoom*=r,l.sub(this.translation,this.translation,e),l.scaleAndAdd(this.translation,e,this.translation,r)}rotateAround(e,r){this.rotation+=r,l.rotate(this.translation,this.translation,e,r)}lerp(e,r){l.lerp(this.translation,this.translation,e.translation,r),this.zoom=(1-r)*this.zoom+r*e.zoom,this.rotation=(1-r)*this.rotation+r*e.rotation}copy(e){l.copy(this.translation,e.translation),this.zoom=e.zoom,this.rotation=e.rotation}apply(e){return l.transformMat2d(e,e,this.matrix())}inverse(){let e=l.negate(l.create(),this.translation);return l.scale(e,e,1/this.zoom),l.rotate(e,e,l.create(),-this.rotation),new t(e,1/this.zoom,-this.rotation)}},E=class{constructor(e){this._listeners=[],this.config={scroll_sensitivity:1.01,rotation_sensitivity:.01,damping_strength:0,panning:!0,zooming:!0,rotating:!0};let r=e instanceof HTMLCanvasElement?e.getContext("2d"):e;if(r===null)throw new Error("Failed to get CanvasRenderingContext2D");this.ctx=r,this.transform=new _,this.target_transform=new _,this.canvas.style.touchAction="none",se(this,this.canvas)}updateDamping(e,r=!0){this.transform.lerp(this.target_transform,1-Math.exp(-e/this.config.damping_strength)),r&&this.updateTransform()}updateTransform(){this.config.damping_strength===0&&this.transform.copy(this.target_transform),this.ctx.resetTransform(),this.ctx.translate(...this.transform.translation),this.ctx.rotate(this.transform.rotation),this.ctx.scale(this.transform.zoom,this.transform.zoom),this._listeners.forEach(e=>e(this))}renderSpaceToScreen(e){return this.transform.apply(e)}screenToRenderSpace(e){return this.transform.inverse().apply(e)}getScreenAABB(){let e=[l.fromValues(0,0),l.fromValues(0,this.canvas.height),l.fromValues(this.canvas.width,0),l.fromValues(this.canvas.width,this.canvas.height)].map(this.screenToRenderSpace.bind(this)),r=e.map(i=>i[0]),n=e.map(i=>i[1]);return[l.fromValues(Math.min(...r),Math.min(...n)),l.fromValues(Math.max(...r),Math.max(...n))]}translate(e){this.target_transform.translate(e)}zoomInto(e,r){this.target_transform.zoomInto(e,r)}rotateAround(e,r){this.target_transform.rotateAround(e,r)}lerp(e,r){this.target_transform.lerp(e,r)}addListener(e){this._listeners.push(e)}removeListener(e){this._listeners.splice(this._listeners.indexOf(e),1)}clearScreen(){this.ctx.save(),this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()}get canvas(){return this.ctx.canvas}get listeners(){return this._listeners.slice()}};function se(t,e){let r={};e.addEventListener("contextmenu",n=>n.preventDefault()),e.addEventListener("pointerdown",n=>{r[n.pointerId]={pos:l.fromValues(n.offsetX,n.offsetY),button:n.button}}),e.addEventListener("pointerup",n=>{delete r[n.pointerId]}),e.addEventListener("pointermove",n=>{let i=r[n.pointerId];if(!i)return;let a=l.clone(i.pos);switch(l.set(i.pos,n.offsetX,n.offsetY),Object.keys(r).length){case 1:i.button===2&&t.config.rotating&&t.rotateAround([e.width/2,e.height/2],t.config.rotation_sensitivity*(i.pos[0]-a[0])),i.button==0&&t.config.panning&&t.translate(l.sub(l.create(),i.pos,a)),t.updateTransform();break;case 2:let o=Object.values(r).find(f=>f!==i);if(o===void 0)throw new Error("something is really wrong bro, good luck debugging ts");let s=l.add(l.create(),i.pos,o.pos);l.scale(s,s,.5);let c=l.sub(l.create(),i.pos,o.pos),h=l.sub(l.create(),a,o.pos);if(t.config.panning){let f=l.sub(l.create(),i.pos,a);t.translate(l.scale(f,f,.5))}t.config.zooming&&t.zoomInto(s,l.len(c)/l.len(h)),t.config.rotating&&t.rotateAround(s,oe(h,c)),t.updateTransform();break}}),e.addEventListener("wheel",n=>{if(!t.config.zooming)return;let i=Math.pow(t.config.scroll_sensitivity,-n.deltaY);t.zoomInto([n.offsetX,n.offsetY],i),t.updateTransform(),n.preventDefault()},{passive:!1})}var w=new Map;function $(t,e){return w.get(t)?.has?.(e)??!1}function A(t,e,r){let n=w.get(t);n===void 0&&(n=new Set,w.set(t,n)),r?n.add(e):n.delete(e)}function G(){w.clear()}function J(t){for(let[e,r]of w)for(let n of r)t(e,n)}function S(t){for(let e=0;e<t;e++)le()}function le(){let t=new Map;for(let[e,r]of w)for(let n of r)for(let i=-1;i<=1;i++){let a=t.get(e+i);a===void 0&&(a=new Set,t.set(e+i,a)),a.add(n-1),a.add(n),a.add(n+1)}for(let[e,r]of t)for(let n of r){let i=0;for(let a=-1;a<=1;a++){let o=w.get(e+a);o!==void 0&&(i+=o.has(n-1)?1:0,i+=o.has(n)?1:0,i+=o.has(n+1)?1:0)}(i<3||i>4)&&t.get(e).delete(n),i===4&&!w.get(e)?.has?.(n)&&t.get(e).delete(n)}w=t}function K(t,e){switch(e){case"rle":return ce(t),!0;case"mc":return fe(t),!0;default:return!1}}function ce(t){let e=t.split(`
`);for(;e[0][0]==="#";)e.shift();let[r,n,i]=e.shift().match(/x ?= ?(\d+) ?, ?y ?= ?(\d+)/),[a,o]=[Number(n),Number(i)],s=[];for(let p=0;p<o;p++)s.push([]);let c="",h=0,f=e.join();for(let p=0;p<f.length&&f[p]!=="!";p++){if(!isNaN(parseInt(f[p]))){c+=f[p];continue}for(let y=0;y<parseInt(c||"1");y++)switch(f[p]){case"$":h++;break;case"b":s[h].push(!1);break;case"o":case"x":case"y":case"z":s[h].push(!0);break}c=""}let m=T(),M=Math.round(m[0]-a/2),v=Math.round(m[1]-o/2);for(let p=0;p<s.length;p++)for(let y=0;y<s[p].length;y++)A(y+M,p+v,s[p][y])}function fe(t){let e=t.trim().split(`
`);do e.shift();while(e[0][0]==="#");function r(a,o,s){if(s===0)return;let c=e[s-1];if(".*$".includes(c[0])){let h=a,f=o;for(let m of c)switch(m){case"*":case".":A(h,f,m==="*"),h++;break;case"$":h=a,f++;break}}else{let[h,f,m,M,v]=c.split(" ").map(y=>Number(y)),p=2**(h-1);r(a,o,f),r(a+p,o,m),r(a,o+p,M),r(a+p,o+p,v)}}let n=2**Number(e[e.length-1].split(" ")[0]),i=T();r(i[0]-n/2,i[1]-n/2,e.length)}var I=document.getElementById("canvas"),b=new E(I),d=b.ctx;b.config.rotating=!1;b.zoomInto([0,0],100);b.translate([window.innerWidth/2,window.innerHeight/2]);function T(){let t=b.screenToRenderSpace([window.innerWidth/2,window.innerHeight/2]);return[Math.round(t[0]),Math.round(t[1])]}function Y(){let t=b.getScreenAABB();b.clearScreen(),d.fillStyle="#404040",J((r,n)=>{d.fillRect(r-.5,n-.5,1,1)});let e=.05;d.strokeStyle="black",d.lineCap="square",d.lineWidth=e;for(let r=Math.round(t[0][0]-e/2)+.5;r<=t[1][0]+e/2;r++)d.beginPath(),d.moveTo(r,t[0][1]),d.lineTo(r,t[1][1]),d.stroke();for(let r=Math.round(t[0][1]-e/2)+.5;r<=t[1][1]+e/2;r++)d.beginPath(),d.moveTo(t[0][0],r),d.lineTo(t[1][0],r),d.stroke()}var P=!1,z=1,R=performance.now(),L=performance.now();function Q(){if(P){let t=performance.now();if(z>1e3/(t-L)){for(let e=0;performance.now()-t<17&&e<z*(t-L)/1e3;e++)S(1);R=t}else z>1e3/(t-R)&&(S(1),R=t)}Y(),L=performance.now(),requestAnimationFrame(Q)}requestAnimationFrame(Q);function U(){I.width=window.innerWidth,I.height=window.innerHeight,b.updateTransform(),Y()}window.addEventListener("resize",U);U();document.getElementById("start").addEventListener("click",()=>P=!P);document.getElementById("step").addEventListener("click",()=>S(1));document.getElementById("clear").addEventListener("click",()=>G());document.getElementById("speed").addEventListener("input",()=>z=2**Number(document.getElementById("speed").value));I.addEventListener("click",t=>{let[e,r]=b.screenToRenderSpace([t.x,t.y]);[e,r]=[Math.round(e),Math.round(r)],A(e,r,!$(e,r)),Y()});document.getElementById("file").addEventListener("change",async()=>{let t=document.getElementById("file"),e=t.files[0];if(e===void 0)return;let r=await e.text();K(r,e.name.split(".").at(-1))||alert("unsupported file format"),t.value=""});export{T as view_center};
