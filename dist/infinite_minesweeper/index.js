var I=Object.defineProperty,z=(t,e,n)=>e in t?I(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,_=(t,e,n)=>z(t,typeof e!="symbol"?e+"":e,n),o=class t{constructor(e,n){_(this,"x"),_(this,"y"),this.x=e,this.y=n}static of([e,n]){return new t(e,n)}add(e){return new t(this.x+e.x,this.y+e.y)}subtract(e){return new t(this.x-e.x,this.y-e.y)}multiply(e){return new t(this.x*e,this.y*e)}divide(e){return new t(this.x/e,this.y/e)}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-e.x*this.y}hadamard(e){return new t(this.x*e.x,this.y*e.y)}length(){return Math.sqrt(this.x**2+this.y**2)}normalize(){let e=this.length();return new t(this.x/e,this.y/e)}rotateByRadians(e){let n=Math.cos(e),i=Math.sin(e);return new t(this.x*n-this.y*i,this.x*i+this.y*n)}rotateByDegrees(e){return this.rotateByRadians(e*Math.PI/180)}};var w=class{state;mine;constructor(e=0,n=Math.random()<S){this.state=e,this.mine=n}};var m=new o(0,0),f=50;function g(t){m=t}function R(t){f=t}var M=new o(window.innerWidth,window.innerHeight).divide(2);function u(t){return typeof t=="number"?t*f:t.subtract(m).multiply(f).add(M)}function p(t){return typeof t=="number"?t/f:t.subtract(M).divide(f).add(m)}function x(t){let e=p(t);return new o(Math.round(e.x),Math.round(e.y))}function c(t){let e=[];for(let n=t.x-1;n<=t.x+1;n++)for(let i=t.y-1;i<=t.y+1;i++)n===t.x&&i===t.y||e.push(new o(n,i));return e}var y=class{a;b;field;constructor(){this.a=new o(-1,-1),this.b=new o(1,1),this.field={[-1]:{},0:{},1:{}};for(let e of c(new o(0,0)))this.field[e.x][e.y]=new w(0,!1);this.field[0][0]=new w(2,!1)}getTile(e){return this.field?.[e.x]?.[e.y]}getTileState(e){return this.getTile(e)?.state||0}getNeighborMineCount(e){let n=0;for(let i of c(e))n+=this.getTile(i)?.mine?1:0;return n}expandField(e,n,i,a){this.a=this.a.subtract(new o(e,i)),this.b=this.b.add(new o(n,a));for(let r=this.a.x;r<=this.b.x;r++){this.field[r]??={};for(let s=this.a.y;s<=this.b.y;s++)this.field[r][s]??=new w}}expandToTile(e){e.x-1<this.a.x&&this.expandField(1+this.a.x-e.x,0,0,0),e.x+1>this.b.x&&this.expandField(0,1+e.x-this.b.x,0,0),e.y-1<this.a.y&&this.expandField(0,0,1+this.a.y-e.y,0),e.y+1>this.b.y&&this.expandField(0,0,0,1+e.y-this.b.y)}setTileState(e,n){this.expandToTile(e);let i=this.getTile(e);if(i===null)throw"what the fuck";return i.state=n,i}detailed_render(e){let n=x(new o(0,0)),i=x(new o(window.innerWidth,window.innerHeight));e.strokeStyle="grey";for(let r=n.x-.5;r<=i.x+.5;r++){let s=u(new o(r,0)).x;e.beginPath(),e.moveTo(s,0),e.lineTo(s,window.innerHeight),e.stroke()}for(let r=n.y-.5;r<=i.y+.5;r++){let s=u(new o(0,r)).y;e.beginPath(),e.moveTo(0,s),e.lineTo(window.innerWidth,s),e.stroke()}let a=.75;for(let r=n.x;r<=i.x;r++)for(let s=n.y;s<=i.y;s++){let h=new o(r,s),l=u(h),d="";switch(this.getTileState(h)){case 1:e.fillStyle="blue",d="F";break;case 2:let V=this.getTile(h).mine;e.fillStyle=V?"red":"white",d=V?"M":this.getNeighborMineCount(h).toString();break}d!==""&&(e.textAlign="center",e.textBaseline="top",e.font=u(a)+"px monospace",e.fillText(d,l.x,l.y-u(7*a/16)))}}simple_render(e){let n=u(1);for(let i in this.field){let a=Number(i),r=this.field[a];for(let s in r){let h=Number(s),l=r[h];if(l.state===0)continue;let d=u(new o(a,h));if(d.x<-10||d.x>window.innerWidth+10)break;d.y<-10||d.y>window.innerHeight+10||(l.state===1&&(e.fillStyle="blue"),l.state===2&&(e.fillStyle=l.mine?"red":"white"),e.fillRect(d.x-n/2,d.y-n/2,n,n))}}}render(e){f>10?this.detailed_render(e):this.simple_render(e)}};async function F(t,e){let n=[new o(0,0)],i=async a=>{for(let r of c(a).concat([a]))n.find(s=>s.x===r.x&&s.y===r.y)===void 0&&n.push(r);await e()};for(;n.length>0;){let a=n[0];if(t.getTileState(a)!==2){n.shift();continue}let r=0,s=0;for(let l of c(a)){let d=t.getTileState(l);d===0&&r++,d===1&&s++}let h=t.getNeighborMineCount(a);if(r===h-s)for(let l of c(a))t.getTileState(l)===0&&(t.setTileState(l,1),await i(l));if(s===h)for(let l of c(a))t.getTileState(l)===0&&(t.setTileState(l,2),await i(l));n.shift()}}var S=Number(prompt("difficulty [0-1]")),T=document.getElementById("canvas"),U=T.getContext("2d"),v=new y;function k(){U.clearRect(0,0,window.innerWidth,window.innerHeight),v.render(U)}function P(){T.width=window.innerWidth,T.height=window.innerHeight,k()}window.onresize=P;P();var b={};window.onpointerdown=t=>{b[t.pointerId]={last_pos:new o(t.x,t.y),total_distance:0,pressed:Date.now()}};window.onpointermove=t=>{let e=b[t.pointerId],n=new o(t.x,t.y),i=e.last_pos;if(e.total_distance+=n.subtract(e.last_pos).length(),e.last_pos=n,!(e.total_distance<10))switch(Object.keys(b).length){case 1:let a=new o(p(t.movementX),p(t.movementY));g(m.subtract(a));break;case 2:let r=parseInt(Object.keys(b).filter(d=>d!==t.pointerId+"")[0]),s=b[r],h=p(n).subtract(p(i)).divide(2),l=n.subtract(s.last_pos).length()/i.subtract(s.last_pos).length();g(m.subtract(h)),R(f*l);break}};window.onpointerup=t=>{delete b[t.pointerId]};for(;;){v=new y;let t=performance.now();await F(v,async()=>{performance.now()-t>100&&(k(),await new Promise(e=>setTimeout(e,1)),t=performance.now())}),k(),await new Promise(e=>setTimeout(e,1))}export{S as difficulty};
