var D=Object.defineProperty,I=(t,e,n)=>e in t?D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,k=(t,e,n)=>I(t,typeof e!="symbol"?e+"":e,n),o=class t{constructor(e,n){k(this,"x"),k(this,"y"),this.x=e,this.y=n}static of([e,n]){return new t(e,n)}add(e){return new t(this.x+e.x,this.y+e.y)}subtract(e){return new t(this.x-e.x,this.y-e.y)}multiply(e){return new t(this.x*e,this.y*e)}divide(e){return new t(this.x/e,this.y/e)}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-e.x*this.y}hadamard(e){return new t(this.x*e.x,this.y*e.y)}length(){return Math.sqrt(this.x**2+this.y**2)}normalize(){let e=this.length();return new t(this.x/e,this.y/e)}rotateByRadians(e){let n=Math.cos(e),r=Math.sin(e);return new t(this.x*n-this.y*r,this.x*r+this.y*n)}rotateByDegrees(e){return this.rotateByRadians(e*Math.PI/180)}};var c=class{state;mine;constructor(e=0,n=Math.random()<S){this.state=e,this.mine=n}};var m=new o(0,0),u=50;function g(t){m=t}function R(t){u=t}var M=new o(window.innerWidth,window.innerHeight).divide(2);function f(t){return typeof t=="number"?t*u:t.subtract(m).multiply(u).add(M)}function y(t){return typeof t=="number"?t/u:t.subtract(M).divide(u).add(m)}function x(t){let e=y(t);return new o(Math.round(e.x),Math.round(e.y))}function w(t){let e=[];for(let n=t.x-1;n<=t.x+1;n++)for(let r=t.y-1;r<=t.y+1;r++)n===t.x&&r===t.y||e.push(new o(n,r));return e}var p=class{a;b;field;constructor(){this.a=new o(-1,-1),this.b=new o(1,1),this.field={[-1]:{},0:{},1:{}};for(let e of w(new o(0,0)))this.field[e.x][e.y]=new c(0,!1);this.field[0][0]=new c(2,!1)}getTile(e){return this.field?.[e.x]?.[e.y]}getTileState(e){return this.getTile(e)?.state||0}getNeighborMineCount(e){let n=0;for(let r of w(e))n+=this.getTile(r)?.mine?1:0;return n}getOuterBorderTiles(){let e=(()=>{let l=new o(0,this.a.y);for(;this.getTile(l).state!==2;)l=new o(0,l.y+1);return[l]})(),n=e.slice(),r=l=>w(l).find(i=>this.getTileState(i)===0)!==void 0;for(;e.length>0;);}expandField(e,n,r,l){this.a=this.a.subtract(new o(e,r)),this.b=this.b.add(new o(n,l));for(let i=this.a.x;i<=this.b.x;i++){this.field[i]??={};for(let s=this.a.y;s<=this.b.y;s++)this.field[i][s]??=new c}}expandToTile(e){e.x-1<this.a.x&&this.expandField(1+this.a.x-e.x,0,0,0),e.x+1>this.b.x&&this.expandField(0,1+e.x-this.b.x,0,0),e.y-1<this.a.y&&this.expandField(0,0,1+this.a.y-e.y,0),e.y+1>this.b.y&&this.expandField(0,0,0,1+e.y-this.b.y)}setTileState(e,n){this.expandToTile(e);let r=this.getTile(e);if(r===null)throw"what the fuck";return r.state=n,r}detailed_render(e){let n=x(new o(0,0)),r=x(new o(window.innerWidth,window.innerHeight));e.strokeStyle="grey";for(let i=n.x-.5;i<=r.x+.5;i++){let s=f(new o(i,0)).x;e.beginPath(),e.moveTo(s,0),e.lineTo(s,window.innerHeight),e.stroke()}for(let i=n.y-.5;i<=r.y+.5;i++){let s=f(new o(0,i)).y;e.beginPath(),e.moveTo(0,s),e.lineTo(window.innerWidth,s),e.stroke()}let l=.75;for(let i=n.x;i<=r.x;i++)for(let s=n.y;s<=r.y;s++){let h=new o(i,s),a=f(h),d="";switch(this.getTileState(h)){case 1:e.fillStyle="blue",d="F";break;case 2:let _=this.getTile(h).mine;e.fillStyle=_?"red":"white",d=_?"M":this.getNeighborMineCount(h).toString();break}d!==""&&(e.textAlign="center",e.textBaseline="top",e.font=f(l)+"px monospace",e.fillText(d,a.x,a.y-f(7*l/16)))}}simple_render(e){let n=f(1);for(let r in this.field){let l=Number(r),i=this.field[l];for(let s in i){let h=Number(s),a=i[h];if(a.state===0)continue;let d=f(new o(l,h));if(d.x<-10||d.x>window.innerWidth+10)break;d.y<-10||d.y>window.innerHeight+10||(a.state===1&&(e.fillStyle="blue"),a.state===2&&(e.fillStyle=a.mine?"red":"white"),e.fillRect(d.x-n/2,d.y-n/2,n,n))}}}render(e){u>10?this.detailed_render(e):this.simple_render(e)}};async function F(t,e){let n=[],r=async l=>{for(let i of w(l).concat([l]))n.find(s=>s.x===i.x&&s.y===i.y)===void 0&&n.push(i);await e()};for(;n.length>0;){let l=n[0];if(t.getTileState(l)!==2){n.shift();continue}let i=0,s=0;for(let a of w(l)){let d=t.getTileState(a);d===0&&i++,d===1&&s++}let h=t.getNeighborMineCount(l);if(i===h-s)for(let a of w(l))t.getTileState(a)===0&&(t.setTileState(a,1),await r(a));if(s===h)for(let a of w(l))t.getTileState(a)===0&&(t.setTileState(a,2),await r(a));n.shift()}}var S=Number(prompt("difficulty [0-1]")),T=document.getElementById("canvas"),U=T.getContext("2d"),v=new p;function V(){U.clearRect(0,0,window.innerWidth,window.innerHeight),v.render(U)}function P(){T.width=window.innerWidth,T.height=window.innerHeight,V()}window.onresize=P;P();var b={};window.onpointerdown=t=>{b[t.pointerId]={last_pos:new o(t.x,t.y),total_distance:0,pressed:Date.now()}};window.onpointermove=t=>{let e=b[t.pointerId],n=new o(t.x,t.y),r=e.last_pos;if(e.total_distance+=n.subtract(e.last_pos).length(),e.last_pos=n,!(e.total_distance<10))switch(Object.keys(b).length){case 1:let l=new o(y(t.movementX),y(t.movementY));g(m.subtract(l));break;case 2:let i=parseInt(Object.keys(b).filter(d=>d!==t.pointerId+"")[0]),s=b[i],h=y(n).subtract(y(r)).divide(2),a=n.subtract(s.last_pos).length()/r.subtract(s.last_pos).length();g(m.subtract(h)),R(u*a);break}};window.onpointerup=t=>{delete b[t.pointerId]};(async()=>{for(;;){v=new p;let t=Date.now();await F(v,async()=>{Date.now()-t>100&&(V(),await new Promise(e=>setTimeout(e,1)),t=Date.now())}),V(),await new Promise(e=>setTimeout(e,1))}})();export{S as difficulty};
