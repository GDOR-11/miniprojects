var D=Object.defineProperty;var R=(t,r)=>{for(var n in r)D(t,n,{get:r[n],enumerable:!0})};var d=1e-6,M=typeof Float32Array<"u"?Float32Array:Array,T=Math.random;var Zt=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,r=arguments.length;r--;)t+=arguments[r]*arguments[r];return Math.sqrt(t)});var m={};R(m,{add:()=>et,clone:()=>F,copy:()=>j,create:()=>B,determinant:()=>J,equals:()=>st,exactEquals:()=>ot,frob:()=>nt,fromRotation:()=>Z,fromScaling:()=>$,fromTranslation:()=>tt,fromValues:()=>W,identity:()=>H,invert:()=>G,mul:()=>ht,multiply:()=>L,multiplyScalar:()=>it,multiplyScalarAndAdd:()=>at,rotate:()=>K,scale:()=>Q,set:()=>X,str:()=>rt,sub:()=>lt,subtract:()=>P,translate:()=>U});function B(){var t=new M(6);return M!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function F(t){var r=new M(6);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r}function j(t,r){return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t}function H(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function W(t,r,n,e,i,a){var o=new M(6);return o[0]=t,o[1]=r,o[2]=n,o[3]=e,o[4]=i,o[5]=a,o}function X(t,r,n,e,i,a,o){return t[0]=r,t[1]=n,t[2]=e,t[3]=i,t[4]=a,t[5]=o,t}function G(t,r){var n=r[0],e=r[1],i=r[2],a=r[3],o=r[4],h=r[5],l=n*a-e*i;return l?(l=1/l,t[0]=a*l,t[1]=-e*l,t[2]=-i*l,t[3]=n*l,t[4]=(i*h-a*o)*l,t[5]=(e*o-n*h)*l,t):null}function J(t){return t[0]*t[3]-t[1]*t[2]}function L(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],h=r[4],l=r[5],c=n[0],f=n[1],g=n[2],v=n[3],y=n[4],z=n[5];return t[0]=e*c+a*f,t[1]=i*c+o*f,t[2]=e*g+a*v,t[3]=i*g+o*v,t[4]=e*y+a*z+h,t[5]=i*y+o*z+l,t}function K(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],h=r[4],l=r[5],c=Math.sin(n),f=Math.cos(n);return t[0]=e*f+a*c,t[1]=i*f+o*c,t[2]=e*-c+a*f,t[3]=i*-c+o*f,t[4]=h,t[5]=l,t}function Q(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],h=r[4],l=r[5],c=n[0],f=n[1];return t[0]=e*c,t[1]=i*c,t[2]=a*f,t[3]=o*f,t[4]=h,t[5]=l,t}function U(t,r,n){var e=r[0],i=r[1],a=r[2],o=r[3],h=r[4],l=r[5],c=n[0],f=n[1];return t[0]=e,t[1]=i,t[2]=a,t[3]=o,t[4]=e*c+a*f+h,t[5]=i*c+o*f+l,t}function Z(t,r){var n=Math.sin(r),e=Math.cos(r);return t[0]=e,t[1]=n,t[2]=-n,t[3]=e,t[4]=0,t[5]=0,t}function $(t,r){return t[0]=r[0],t[1]=0,t[2]=0,t[3]=r[1],t[4]=0,t[5]=0,t}function tt(t,r){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=r[0],t[5]=r[1],t}function rt(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function nt(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function et(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t[3]=r[3]+n[3],t[4]=r[4]+n[4],t[5]=r[5]+n[5],t}function P(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t[2]=r[2]-n[2],t[3]=r[3]-n[3],t[4]=r[4]-n[4],t[5]=r[5]-n[5],t}function it(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t[2]=r[2]*n,t[3]=r[3]*n,t[4]=r[4]*n,t[5]=r[5]*n,t}function at(t,r,n,e){return t[0]=r[0]+n[0]*e,t[1]=r[1]+n[1]*e,t[2]=r[2]+n[2]*e,t[3]=r[3]+n[3]*e,t[4]=r[4]+n[4]*e,t[5]=r[5]+n[5]*e,t}function ot(t,r){return t[0]===r[0]&&t[1]===r[1]&&t[2]===r[2]&&t[3]===r[3]&&t[4]===r[4]&&t[5]===r[5]}function st(t,r){var n=t[0],e=t[1],i=t[2],a=t[3],o=t[4],h=t[5],l=r[0],c=r[1],f=r[2],g=r[3],v=r[4],y=r[5];return Math.abs(n-l)<=d*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(e-c)<=d*Math.max(1,Math.abs(e),Math.abs(c))&&Math.abs(i-f)<=d*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-g)<=d*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(o-v)<=d*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(h-y)<=d*Math.max(1,Math.abs(h),Math.abs(y))}var ht=L,lt=P;var s={};R(s,{add:()=>mt,angle:()=>qt,ceil:()=>dt,clone:()=>ft,copy:()=>xt,create:()=>Y,cross:()=>Rt,dist:()=>jt,distance:()=>O,div:()=>Ft,divide:()=>q,dot:()=>zt,equals:()=>Vt,exactEquals:()=>kt,floor:()=>Mt,forEach:()=>Xt,fromValues:()=>ct,inverse:()=>Et,len:()=>Ct,length:()=>k,lerp:()=>Tt,max:()=>gt,min:()=>ut,mul:()=>Bt,multiply:()=>b,negate:()=>wt,normalize:()=>_t,random:()=>St,rotate:()=>bt,round:()=>vt,scale:()=>yt,scaleAndAdd:()=>At,set:()=>pt,sqrDist:()=>Ht,sqrLen:()=>Wt,squaredDistance:()=>N,squaredLength:()=>V,str:()=>Nt,sub:()=>Dt,subtract:()=>I,transformMat2:()=>Lt,transformMat2d:()=>Pt,transformMat3:()=>Yt,transformMat4:()=>It,zero:()=>Ot});function Y(){var t=new M(2);return M!=Float32Array&&(t[0]=0,t[1]=0),t}function ft(t){var r=new M(2);return r[0]=t[0],r[1]=t[1],r}function ct(t,r){var n=new M(2);return n[0]=t,n[1]=r,n}function xt(t,r){return t[0]=r[0],t[1]=r[1],t}function pt(t,r,n){return t[0]=r,t[1]=n,t}function mt(t,r,n){return t[0]=r[0]+n[0],t[1]=r[1]+n[1],t}function I(t,r,n){return t[0]=r[0]-n[0],t[1]=r[1]-n[1],t}function b(t,r,n){return t[0]=r[0]*n[0],t[1]=r[1]*n[1],t}function q(t,r,n){return t[0]=r[0]/n[0],t[1]=r[1]/n[1],t}function dt(t,r){return t[0]=Math.ceil(r[0]),t[1]=Math.ceil(r[1]),t}function Mt(t,r){return t[0]=Math.floor(r[0]),t[1]=Math.floor(r[1]),t}function ut(t,r,n){return t[0]=Math.min(r[0],n[0]),t[1]=Math.min(r[1],n[1]),t}function gt(t,r,n){return t[0]=Math.max(r[0],n[0]),t[1]=Math.max(r[1],n[1]),t}function vt(t,r){return t[0]=Math.round(r[0]),t[1]=Math.round(r[1]),t}function yt(t,r,n){return t[0]=r[0]*n,t[1]=r[1]*n,t}function At(t,r,n,e){return t[0]=r[0]+n[0]*e,t[1]=r[1]+n[1]*e,t}function O(t,r){var n=r[0]-t[0],e=r[1]-t[1];return Math.hypot(n,e)}function N(t,r){var n=r[0]-t[0],e=r[1]-t[1];return n*n+e*e}function k(t){var r=t[0],n=t[1];return Math.hypot(r,n)}function V(t){var r=t[0],n=t[1];return r*r+n*n}function wt(t,r){return t[0]=-r[0],t[1]=-r[1],t}function Et(t,r){return t[0]=1/r[0],t[1]=1/r[1],t}function _t(t,r){var n=r[0],e=r[1],i=n*n+e*e;return i>0&&(i=1/Math.sqrt(i)),t[0]=r[0]*i,t[1]=r[1]*i,t}function zt(t,r){return t[0]*r[0]+t[1]*r[1]}function Rt(t,r,n){var e=r[0]*n[1]-r[1]*n[0];return t[0]=t[1]=0,t[2]=e,t}function Tt(t,r,n,e){var i=r[0],a=r[1];return t[0]=i+e*(n[0]-i),t[1]=a+e*(n[1]-a),t}function St(t,r){r=r||1;var n=T()*2*Math.PI;return t[0]=Math.cos(n)*r,t[1]=Math.sin(n)*r,t}function Lt(t,r,n){var e=r[0],i=r[1];return t[0]=n[0]*e+n[2]*i,t[1]=n[1]*e+n[3]*i,t}function Pt(t,r,n){var e=r[0],i=r[1];return t[0]=n[0]*e+n[2]*i+n[4],t[1]=n[1]*e+n[3]*i+n[5],t}function Yt(t,r,n){var e=r[0],i=r[1];return t[0]=n[0]*e+n[3]*i+n[6],t[1]=n[1]*e+n[4]*i+n[7],t}function It(t,r,n){var e=r[0],i=r[1];return t[0]=n[0]*e+n[4]*i+n[12],t[1]=n[1]*e+n[5]*i+n[13],t}function bt(t,r,n,e){var i=r[0]-n[0],a=r[1]-n[1],o=Math.sin(e),h=Math.cos(e);return t[0]=i*h-a*o+n[0],t[1]=i*o+a*h+n[1],t}function qt(t,r){var n=t[0],e=t[1],i=r[0],a=r[1],o=Math.sqrt(n*n+e*e)*Math.sqrt(i*i+a*a),h=o&&(n*i+e*a)/o;return Math.acos(Math.min(Math.max(h,-1),1))}function Ot(t){return t[0]=0,t[1]=0,t}function Nt(t){return"vec2("+t[0]+", "+t[1]+")"}function kt(t,r){return t[0]===r[0]&&t[1]===r[1]}function Vt(t,r){var n=t[0],e=t[1],i=r[0],a=r[1];return Math.abs(n-i)<=d*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(e-a)<=d*Math.max(1,Math.abs(e),Math.abs(a))}var Ct=k,Dt=I,Bt=b,Ft=q,jt=O,Ht=N,Wt=V,Xt=function(){var t=Y();return function(r,n,e,i,a,o){var h,l;for(n||(n=2),e||(e=0),i?l=Math.min(i*n+e,r.length):l=r.length,h=e;h<l;h+=n)t[0]=r[h],t[1]=r[h+1],a(t,t,o),r[h]=t[0],r[h+1]=t[1];return r}}();function Gt(t,r){let n=t[0],e=t[1],i=r[0],a=r[1];return Math.atan2(n*a-e*i,n*i+e*a)}var w=class t{constructor(r,n,e){this.translation=s.create(),this.zoom=1,this.rotation=0,this.translation=r||this.translation,this.zoom=n||this.zoom,this.rotation=e||this.rotation}translationMatrix(){return m.fromTranslation(m.create(),this.translation)}scalingMatrix(){return m.fromScaling(m.create(),[this.zoom,this.zoom])}rotationMatrix(){return m.fromRotation(m.create(),this.rotation)}matrix(){let r=m.create();return m.mul(r,this.translationMatrix(),this.scalingMatrix()),m.mul(r,r,this.rotationMatrix()),r}translate(r){s.add(this.translation,this.translation,r)}zoomInto(r,n){this.zoom*=n,s.sub(this.translation,this.translation,r),s.scaleAndAdd(this.translation,r,this.translation,n)}rotateAround(r,n){this.rotation+=n,s.rotate(this.translation,this.translation,r,n)}lerp(r,n){s.lerp(this.translation,this.translation,r.translation,n),this.zoom=(1-n)*this.zoom+n*r.zoom,this.rotation=(1-n)*this.rotation+n*r.rotation}copy(r){s.copy(this.translation,r.translation),this.zoom=r.zoom,this.rotation=r.rotation}apply(r){return s.transformMat2d(r,r,this.matrix())}inverse(){let r=s.negate(s.create(),this.translation);return s.scale(r,r,1/this.zoom),s.rotate(r,r,s.create(),-this.rotation),new t(r,1/this.zoom,-this.rotation)}},A=class{constructor(r){this._listeners=[],this.config={scroll_sensitivity:1.01,rotation_sensitivity:.01,damping_strength:0,panning:!0,zooming:!0,rotating:!0};let n=r instanceof HTMLCanvasElement?r.getContext("2d"):r;if(n===null)throw new Error("Failed to get CanvasRenderingContext2D");this.ctx=n,this.transform=new w,this.target_transform=new w,this.canvas.style.touchAction="none",Jt(this,this.canvas)}updateDamping(r,n=!0){this.transform.lerp(this.target_transform,1-Math.exp(-r/this.config.damping_strength)),n&&this.updateTransform()}updateTransform(){this.config.damping_strength===0&&this.transform.copy(this.target_transform),this.ctx.resetTransform(),this.ctx.translate(...this.transform.translation),this.ctx.rotate(this.transform.rotation),this.ctx.scale(this.transform.zoom,this.transform.zoom),this._listeners.forEach(r=>r(this))}renderSpaceToScreen(r){return this.transform.apply(r)}screenToRenderSpace(r){return this.transform.inverse().apply(r)}getScreenAABB(){let r=[s.fromValues(0,0),s.fromValues(0,this.canvas.height),s.fromValues(this.canvas.width,0),s.fromValues(this.canvas.width,this.canvas.height)].map(this.screenToRenderSpace.bind(this)),n=r.map(i=>i[0]),e=r.map(i=>i[1]);return[s.fromValues(Math.min(...n),Math.min(...e)),s.fromValues(Math.max(...n),Math.max(...e))]}translate(r){this.target_transform.translate(r)}zoomInto(r,n){this.target_transform.zoomInto(r,n)}rotateAround(r,n){this.target_transform.rotateAround(r,n)}lerp(r,n){this.target_transform.lerp(r,n)}addListener(r){this._listeners.push(r)}removeListener(r){this._listeners.splice(this._listeners.indexOf(r),1)}clearScreen(){this.ctx.save(),this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore()}get canvas(){return this.ctx.canvas}get listeners(){return this._listeners.slice()}};function Jt(t,r){let n={};r.addEventListener("contextmenu",e=>e.preventDefault()),r.addEventListener("pointerdown",e=>{n[e.pointerId]={pos:s.fromValues(e.offsetX,e.offsetY),button:e.button}}),r.addEventListener("pointerup",e=>{delete n[e.pointerId]}),r.addEventListener("pointermove",e=>{let i=n[e.pointerId];if(!i)return;let a=s.clone(i.pos);switch(s.set(i.pos,e.offsetX,e.offsetY),Object.keys(n).length){case 1:i.button===2&&t.config.rotating&&t.rotateAround([r.width/2,r.height/2],t.config.rotation_sensitivity*(i.pos[0]-a[0])),i.button==0&&t.config.panning&&t.translate(s.sub(s.create(),i.pos,a)),t.updateTransform();break;case 2:let o=Object.values(n).find(f=>f!==i);if(o===void 0)throw new Error("something is really wrong bro, good luck debugging ts");let h=s.add(s.create(),i.pos,o.pos);s.scale(h,h,.5);let l=s.sub(s.create(),i.pos,o.pos),c=s.sub(s.create(),a,o.pos);if(t.config.panning){let f=s.sub(s.create(),i.pos,a);t.translate(s.scale(f,f,.5))}t.config.zooming&&t.zoomInto(h,s.len(l)/s.len(c)),t.config.rotating&&t.rotateAround(h,Gt(c,l)),t.updateTransform();break}}),r.addEventListener("wheel",e=>{if(!t.config.zooming)return;let i=Math.pow(t.config.scroll_sensitivity,-e.deltaY);t.zoomInto([e.offsetX,e.offsetY],i),t.updateTransform(),e.preventDefault()},{passive:!1})}var E=document.getElementById("canvas"),u=new A(E),p=u.ctx;u.config.rotating=!1;u.zoomInto([0,0],100);u.translate([window.innerWidth/2,window.innerHeight/2]);var x=[[!0,!0],[!0,!1]];function _(){let t=u.getScreenAABB();u.clearScreen(),p.fillStyle="#404040";for(let n=0;n<x.length;n++)for(let e=0;e<x[n].length;e++)x[n][e]&&p.fillRect(n-.5,-e-.5,1,1);let r=.05;p.strokeStyle="black",p.lineCap="square",p.lineWidth=r;for(let n=-.5;n<=t[1][0]+r/2;n++)p.beginPath(),p.moveTo(n,t[0][1]),p.lineTo(n,Math.min(.5,t[1][1])),p.stroke();for(let n=.5;n>=t[0][1]-r/2;n--)p.beginPath(),p.moveTo(Math.max(-.5,t[0][0]),n),p.lineTo(t[1][0],n),p.stroke()}u.addListener(_);function C(){E.width=window.innerWidth,E.height=window.innerHeight,u.updateTransform(),_()}window.addEventListener("resize",C);C();window.addEventListener("click",t=>{let[r,n]=u.screenToRenderSpace([t.x,t.y]);[r,n]=[Math.round(r),Math.round(-n)],x[r]?.[n]===!0&&x[r+1]?.[n]!==!0&&x[r]?.[n+1]!==!0&&(r===x.length-1&&x.push(new Array(x[r].length).fill(!1)),n===x[r].length-1&&x.forEach(e=>e.push(!1)),x[r][n]=!1,x[r+1][n]=!0,x[r][n+1]=!0,_())});
