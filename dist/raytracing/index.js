var cr=Object.defineProperty;var hr=(r,e)=>{for(var a in e)cr(r,a,{get:e[a],enumerable:!0})};var Z=`#version 300 es
precision highp float;precision highp int;precision highp sampler2D;struct Ray{vec3 origin;vec3 direction;};struct Material{vec3 albedo;vec3 emissivity;};struct Collision{float distance;vec3 normal;Material material;};struct Sphere{vec3 center;float radius;bool inverted;Material material;};void sphereIntersection(inout Collision current,Ray ray,Sphere sphere){vec3 oc=ray.origin-sphere.center;float b=dot(oc,ray.direction);if(b>0.0&&!sphere.inverted)return;float c=dot(oc,oc)-sphere.radius*sphere.radius;if(c<0.0!=sphere.inverted)return;float a=dot(ray.direction,ray.direction);float d=b*b-a*c;if(d<0.0)return;float t=(-b+(sphere.inverted?1.0:-1.0)*sqrt(d))/a;if(t>=current.distance&&current.distance>=0.0)return;current.distance=t;vec3 hitPoint=ray.origin+t*ray.direction;current.normal=(sphere.inverted?-1.0:1.0)*(hitPoint-sphere.center)/sphere.radius;current.material=sphere.material;}Collision sceneIntersection(Ray ray){Sphere sphere1=Sphere(vec3(0.0,-1.0,10.0),1.0,false,Material(vec3(0.0,1.0,1.0),vec3(0.0)));Sphere sphere2=Sphere(vec3(0.0,1.0,10.0),1.0,false,Material(vec3(1.0,1.0,0.0),vec3(0.0)));Sphere sphere3=Sphere(vec3(2.0,3.0,8.0),1.0,false,Material(vec3(0.0,0.0,0.0),vec3(4.0)));Sphere sphere4=Sphere(vec3(0.0,0.0,5.0),5.1,true,Material(vec3(1.0,1.0,1.0),vec3(0.0)));Collision collision;collision.distance=-1.0;sphereIntersection(collision,ray,sphere1);sphereIntersection(collision,ray,sphere2);sphereIntersection(collision,ray,sphere3);sphereIntersection(collision,ray,sphere4);return collision;}vec3 hash(vec3 p){p=fract(p*vec3(0.1031,0.1030,0.0973));p+=dot(p,p.yzx+33.33);return fract((p.xxy+p.yzz)*p.zyx);}vec3 int_hash(uvec3 x){x=((x>>8U)^ x.yzx)*1103515245U;x=((x>>8U)^ x.yzx)*1103515245U;x=((x>>8U)^ x.yzx)*1103515245U;return vec3(x)*(1.0/float(0xffffffffU));}vec3 randomUnitVector(vec3 seed){vec3 v=vec3(1.0);for(int i=0;length(v)>1.0||length(v)==0.0;i++){vec3 h=seed=hash(seed-vec3(1.0));v=h*2.0-vec3(1.0);}return normalize(v);}float colorCorrection(float intensity){return intensity<=0.0031308?12.92*intensity:1.055*pow(intensity,1.0/2.4)-0.055;}uniform mat4 u_viewMatrix;uniform int u_frame;uniform sampler2D u_lastFrame;uniform bool u_render;in vec3 v_pixelLocation;out vec4 outColor;void main(){vec2 uv=gl_FragCoord.xy/vec2(textureSize(u_lastFrame,0));if(u_render){outColor=texture(u_lastFrame,uv)/float(u_frame+1);outColor=vec4(colorCorrection(outColor.r),colorCorrection(outColor.g),colorCorrection(outColor.b),1.0);return;}vec4 origin=u_viewMatrix*vec4(0.0,0.0,0.0,1.0);vec4 direction=u_viewMatrix*vec4(normalize(v_pixelLocation),0.0);vec3 seed=int_hash(uvec3(gl_FragCoord.xy,u_frame));vec3 color=vec3(0.0);vec3 contribution=vec3(1.0);Ray ray=Ray(origin.xyz,direction.xyz);for(int i=0;i<5;i++){Collision collision=sceneIntersection(ray);vec3 hitPoint=ray.origin+ray.direction*collision.distance+collision.normal*0.001;if(collision.distance<0.0)break;color+=contribution*collision.material.emissivity;contribution*=collision.material.albedo;if(contribution==vec3(0.0))break;ray.origin=hitPoint;ray.direction=randomUnitVector(seed=hash(seed));if(dot(ray.direction,collision.normal)<0.0){ray.direction=-ray.direction;}contribution*=dot(ray.direction,collision.normal);}if(u_frame==0){outColor=vec4(color,1.0);return;}outColor.rgb=texture(u_lastFrame,uv).rgb+color;outColor.a=1.0;}`;var j=`#version 300 es
uniform vec2 u_screenSize;out vec3 v_pixelLocation;in vec2 a_position;void main(){gl_Position=vec4(a_position,0,1);v_pixelLocation=vec3(0.5*a_position*u_screenSize,1);}`;var O=1e-6,C=typeof Float32Array<"u"?Float32Array:Array;var m1=Math.PI/180,M1=180/Math.PI;var B={};hr(B,{add:()=>Qr,adjoint:()=>yr,clone:()=>lr,copy:()=>mr,create:()=>fr,decompose:()=>Nr,determinant:()=>gr,equals:()=>or,exactEquals:()=>Jr,frob:()=>jr,fromQuat:()=>Gr,fromQuat2:()=>Fr,fromRotation:()=>Lr,fromRotationTranslation:()=>K,fromRotationTranslationScale:()=>Cr,fromRotationTranslationScaleOrigin:()=>Dr,fromScaling:()=>_r,fromTranslation:()=>Ar,fromValues:()=>Mr,fromXRotation:()=>Pr,fromYRotation:()=>Ir,fromZRotation:()=>wr,frustum:()=>qr,getRotation:()=>Ur,getScaling:()=>J,getTranslation:()=>Or,identity:()=>Q,invert:()=>dr,lookAt:()=>kr,mul:()=>ur,multiply:()=>$,multiplyScalar:()=>$r,multiplyScalarAndAdd:()=>Kr,ortho:()=>Vr,orthoNO:()=>u,orthoZO:()=>Wr,perspective:()=>Xr,perspectiveFromFieldOfView:()=>Br,perspectiveNO:()=>o,perspectiveZO:()=>Yr,rotate:()=>br,rotateX:()=>Tr,rotateY:()=>zr,rotateZ:()=>Sr,scale:()=>Rr,set:()=>pr,str:()=>Zr,sub:()=>r1,subtract:()=>rr,targetTo:()=>Hr,translate:()=>Er,transpose:()=>tr});function fr(){var r=new C(16);return C!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function lr(r){var e=new C(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function mr(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Mr(r,e,a,n,i,v,s,c,x,h,f,m,p,M,t,y){var l=new C(16);return l[0]=r,l[1]=e,l[2]=a,l[3]=n,l[4]=i,l[5]=v,l[6]=s,l[7]=c,l[8]=x,l[9]=h,l[10]=f,l[11]=m,l[12]=p,l[13]=M,l[14]=t,l[15]=y,l}function pr(r,e,a,n,i,v,s,c,x,h,f,m,p,M,t,y,l){return r[0]=e,r[1]=a,r[2]=n,r[3]=i,r[4]=v,r[5]=s,r[6]=c,r[7]=x,r[8]=h,r[9]=f,r[10]=m,r[11]=p,r[12]=M,r[13]=t,r[14]=y,r[15]=l,r}function Q(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function tr(r,e){if(r===e){var a=e[1],n=e[2],i=e[3],v=e[6],s=e[7],c=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=a,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=v,r[11]=e[14],r[12]=i,r[13]=s,r[14]=c}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function dr(r,e){var a=e[0],n=e[1],i=e[2],v=e[3],s=e[4],c=e[5],x=e[6],h=e[7],f=e[8],m=e[9],p=e[10],M=e[11],t=e[12],y=e[13],l=e[14],T=e[15],S=a*c-n*s,b=a*x-i*s,g=a*h-v*s,E=n*x-i*c,R=n*h-v*c,L=i*h-v*x,A=f*y-m*t,P=f*l-p*t,z=f*T-M*t,I=m*l-p*y,w=m*T-M*y,F=p*T-M*l,_=S*F-b*w+g*I+E*z-R*P+L*A;return _?(_=1/_,r[0]=(c*F-x*w+h*I)*_,r[1]=(i*w-n*F-v*I)*_,r[2]=(y*L-l*R+T*E)*_,r[3]=(p*R-m*L-M*E)*_,r[4]=(x*z-s*F-h*P)*_,r[5]=(a*F-i*z+v*P)*_,r[6]=(l*g-t*L-T*b)*_,r[7]=(f*L-p*g+M*b)*_,r[8]=(s*w-c*z+h*A)*_,r[9]=(n*z-a*w-v*A)*_,r[10]=(t*R-y*g+T*S)*_,r[11]=(m*g-f*R-M*S)*_,r[12]=(c*P-s*I-x*A)*_,r[13]=(a*I-n*P+i*A)*_,r[14]=(y*b-t*E-l*S)*_,r[15]=(f*E-m*b+p*S)*_,r):null}function yr(r,e){var a=e[0],n=e[1],i=e[2],v=e[3],s=e[4],c=e[5],x=e[6],h=e[7],f=e[8],m=e[9],p=e[10],M=e[11],t=e[12],y=e[13],l=e[14],T=e[15],S=a*c-n*s,b=a*x-i*s,g=a*h-v*s,E=n*x-i*c,R=n*h-v*c,L=i*h-v*x,A=f*y-m*t,P=f*l-p*t,z=f*T-M*t,I=m*l-p*y,w=m*T-M*y,F=p*T-M*l;return r[0]=c*F-x*w+h*I,r[1]=i*w-n*F-v*I,r[2]=y*L-l*R+T*E,r[3]=p*R-m*L-M*E,r[4]=x*z-s*F-h*P,r[5]=a*F-i*z+v*P,r[6]=l*g-t*L-T*b,r[7]=f*L-p*g+M*b,r[8]=s*w-c*z+h*A,r[9]=n*z-a*w-v*A,r[10]=t*R-y*g+T*S,r[11]=m*g-f*R-M*S,r[12]=c*P-s*I-x*A,r[13]=a*I-n*P+i*A,r[14]=y*b-t*E-l*S,r[15]=f*E-m*b+p*S,r}function gr(r){var e=r[0],a=r[1],n=r[2],i=r[3],v=r[4],s=r[5],c=r[6],x=r[7],h=r[8],f=r[9],m=r[10],p=r[11],M=r[12],t=r[13],y=r[14],l=r[15],T=e*s-a*v,S=e*c-n*v,b=a*c-n*s,g=h*t-f*M,E=h*y-m*M,R=f*y-m*t,L=e*R-a*E+n*g,A=v*R-s*E+c*g,P=h*b-f*S+m*T,z=M*b-t*S+y*T;return x*L-i*A+l*P-p*z}function $(r,e,a){var n=e[0],i=e[1],v=e[2],s=e[3],c=e[4],x=e[5],h=e[6],f=e[7],m=e[8],p=e[9],M=e[10],t=e[11],y=e[12],l=e[13],T=e[14],S=e[15],b=a[0],g=a[1],E=a[2],R=a[3];return r[0]=b*n+g*c+E*m+R*y,r[1]=b*i+g*x+E*p+R*l,r[2]=b*v+g*h+E*M+R*T,r[3]=b*s+g*f+E*t+R*S,b=a[4],g=a[5],E=a[6],R=a[7],r[4]=b*n+g*c+E*m+R*y,r[5]=b*i+g*x+E*p+R*l,r[6]=b*v+g*h+E*M+R*T,r[7]=b*s+g*f+E*t+R*S,b=a[8],g=a[9],E=a[10],R=a[11],r[8]=b*n+g*c+E*m+R*y,r[9]=b*i+g*x+E*p+R*l,r[10]=b*v+g*h+E*M+R*T,r[11]=b*s+g*f+E*t+R*S,b=a[12],g=a[13],E=a[14],R=a[15],r[12]=b*n+g*c+E*m+R*y,r[13]=b*i+g*x+E*p+R*l,r[14]=b*v+g*h+E*M+R*T,r[15]=b*s+g*f+E*t+R*S,r}function Er(r,e,a){var n=a[0],i=a[1],v=a[2],s,c,x,h,f,m,p,M,t,y,l,T;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*v+e[12],r[13]=e[1]*n+e[5]*i+e[9]*v+e[13],r[14]=e[2]*n+e[6]*i+e[10]*v+e[14],r[15]=e[3]*n+e[7]*i+e[11]*v+e[15]):(s=e[0],c=e[1],x=e[2],h=e[3],f=e[4],m=e[5],p=e[6],M=e[7],t=e[8],y=e[9],l=e[10],T=e[11],r[0]=s,r[1]=c,r[2]=x,r[3]=h,r[4]=f,r[5]=m,r[6]=p,r[7]=M,r[8]=t,r[9]=y,r[10]=l,r[11]=T,r[12]=s*n+f*i+t*v+e[12],r[13]=c*n+m*i+y*v+e[13],r[14]=x*n+p*i+l*v+e[14],r[15]=h*n+M*i+T*v+e[15]),r}function Rr(r,e,a){var n=a[0],i=a[1],v=a[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*v,r[9]=e[9]*v,r[10]=e[10]*v,r[11]=e[11]*v,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function br(r,e,a,n){var i=n[0],v=n[1],s=n[2],c=Math.sqrt(i*i+v*v+s*s),x,h,f,m,p,M,t,y,l,T,S,b,g,E,R,L,A,P,z,I,w,F,_,U;return c<O?null:(c=1/c,i*=c,v*=c,s*=c,x=Math.sin(a),h=Math.cos(a),f=1-h,m=e[0],p=e[1],M=e[2],t=e[3],y=e[4],l=e[5],T=e[6],S=e[7],b=e[8],g=e[9],E=e[10],R=e[11],L=i*i*f+h,A=v*i*f+s*x,P=s*i*f-v*x,z=i*v*f-s*x,I=v*v*f+h,w=s*v*f+i*x,F=i*s*f+v*x,_=v*s*f-i*x,U=s*s*f+h,r[0]=m*L+y*A+b*P,r[1]=p*L+l*A+g*P,r[2]=M*L+T*A+E*P,r[3]=t*L+S*A+R*P,r[4]=m*z+y*I+b*w,r[5]=p*z+l*I+g*w,r[6]=M*z+T*I+E*w,r[7]=t*z+S*I+R*w,r[8]=m*F+y*_+b*U,r[9]=p*F+l*_+g*U,r[10]=M*F+T*_+E*U,r[11]=t*F+S*_+R*U,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function Tr(r,e,a){var n=Math.sin(a),i=Math.cos(a),v=e[4],s=e[5],c=e[6],x=e[7],h=e[8],f=e[9],m=e[10],p=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=v*i+h*n,r[5]=s*i+f*n,r[6]=c*i+m*n,r[7]=x*i+p*n,r[8]=h*i-v*n,r[9]=f*i-s*n,r[10]=m*i-c*n,r[11]=p*i-x*n,r}function zr(r,e,a){var n=Math.sin(a),i=Math.cos(a),v=e[0],s=e[1],c=e[2],x=e[3],h=e[8],f=e[9],m=e[10],p=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=v*i-h*n,r[1]=s*i-f*n,r[2]=c*i-m*n,r[3]=x*i-p*n,r[8]=v*n+h*i,r[9]=s*n+f*i,r[10]=c*n+m*i,r[11]=x*n+p*i,r}function Sr(r,e,a){var n=Math.sin(a),i=Math.cos(a),v=e[0],s=e[1],c=e[2],x=e[3],h=e[4],f=e[5],m=e[6],p=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=v*i+h*n,r[1]=s*i+f*n,r[2]=c*i+m*n,r[3]=x*i+p*n,r[4]=h*i-v*n,r[5]=f*i-s*n,r[6]=m*i-c*n,r[7]=p*i-x*n,r}function Ar(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function _r(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Lr(r,e,a){var n=a[0],i=a[1],v=a[2],s=Math.sqrt(n*n+i*i+v*v),c,x,h;return s<O?null:(s=1/s,n*=s,i*=s,v*=s,c=Math.sin(e),x=Math.cos(e),h=1-x,r[0]=n*n*h+x,r[1]=i*n*h+v*c,r[2]=v*n*h-i*c,r[3]=0,r[4]=n*i*h-v*c,r[5]=i*i*h+x,r[6]=v*i*h+n*c,r[7]=0,r[8]=n*v*h+i*c,r[9]=i*v*h-n*c,r[10]=v*v*h+x,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Pr(r,e){var a=Math.sin(e),n=Math.cos(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=a,r[7]=0,r[8]=0,r[9]=-a,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ir(r,e){var a=Math.sin(e),n=Math.cos(e);return r[0]=n,r[1]=0,r[2]=-a,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=a,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function wr(r,e){var a=Math.sin(e),n=Math.cos(e);return r[0]=n,r[1]=a,r[2]=0,r[3]=0,r[4]=-a,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function K(r,e,a){var n=e[0],i=e[1],v=e[2],s=e[3],c=n+n,x=i+i,h=v+v,f=n*c,m=n*x,p=n*h,M=i*x,t=i*h,y=v*h,l=s*c,T=s*x,S=s*h;return r[0]=1-(M+y),r[1]=m+S,r[2]=p-T,r[3]=0,r[4]=m-S,r[5]=1-(f+y),r[6]=t+l,r[7]=0,r[8]=p+T,r[9]=t-l,r[10]=1-(f+M),r[11]=0,r[12]=a[0],r[13]=a[1],r[14]=a[2],r[15]=1,r}function Fr(r,e){var a=new C(3),n=-e[0],i=-e[1],v=-e[2],s=e[3],c=e[4],x=e[5],h=e[6],f=e[7],m=n*n+i*i+v*v+s*s;return m>0?(a[0]=(c*s+f*n+x*v-h*i)*2/m,a[1]=(x*s+f*i+h*n-c*v)*2/m,a[2]=(h*s+f*v+c*i-x*n)*2/m):(a[0]=(c*s+f*n+x*v-h*i)*2,a[1]=(x*s+f*i+h*n-c*v)*2,a[2]=(h*s+f*v+c*i-x*n)*2),K(r,e,a),r}function Or(r,e){return r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function J(r,e){var a=e[0],n=e[1],i=e[2],v=e[4],s=e[5],c=e[6],x=e[8],h=e[9],f=e[10];return r[0]=Math.sqrt(a*a+n*n+i*i),r[1]=Math.sqrt(v*v+s*s+c*c),r[2]=Math.sqrt(x*x+h*h+f*f),r}function Ur(r,e){var a=new C(3);J(a,e);var n=1/a[0],i=1/a[1],v=1/a[2],s=e[0]*n,c=e[1]*i,x=e[2]*v,h=e[4]*n,f=e[5]*i,m=e[6]*v,p=e[8]*n,M=e[9]*i,t=e[10]*v,y=s+f+t,l=0;return y>0?(l=Math.sqrt(y+1)*2,r[3]=.25*l,r[0]=(m-M)/l,r[1]=(p-x)/l,r[2]=(c-h)/l):s>f&&s>t?(l=Math.sqrt(1+s-f-t)*2,r[3]=(m-M)/l,r[0]=.25*l,r[1]=(c+h)/l,r[2]=(p+x)/l):f>t?(l=Math.sqrt(1+f-s-t)*2,r[3]=(p-x)/l,r[0]=(c+h)/l,r[1]=.25*l,r[2]=(m+M)/l):(l=Math.sqrt(1+t-s-f)*2,r[3]=(c-h)/l,r[0]=(p+x)/l,r[1]=(m+M)/l,r[2]=.25*l),r}function Nr(r,e,a,n){e[0]=n[12],e[1]=n[13],e[2]=n[14];var i=n[0],v=n[1],s=n[2],c=n[4],x=n[5],h=n[6],f=n[8],m=n[9],p=n[10];a[0]=Math.sqrt(i*i+v*v+s*s),a[1]=Math.sqrt(c*c+x*x+h*h),a[2]=Math.sqrt(f*f+m*m+p*p);var M=1/a[0],t=1/a[1],y=1/a[2],l=i*M,T=v*t,S=s*y,b=c*M,g=x*t,E=h*y,R=f*M,L=m*t,A=p*y,P=l+g+A,z=0;return P>0?(z=Math.sqrt(P+1)*2,r[3]=.25*z,r[0]=(E-L)/z,r[1]=(R-S)/z,r[2]=(T-b)/z):l>g&&l>A?(z=Math.sqrt(1+l-g-A)*2,r[3]=(E-L)/z,r[0]=.25*z,r[1]=(T+b)/z,r[2]=(R+S)/z):g>A?(z=Math.sqrt(1+g-l-A)*2,r[3]=(R-S)/z,r[0]=(T+b)/z,r[1]=.25*z,r[2]=(E+L)/z):(z=Math.sqrt(1+A-l-g)*2,r[3]=(T-b)/z,r[0]=(R+S)/z,r[1]=(E+L)/z,r[2]=.25*z),r}function Cr(r,e,a,n){var i=e[0],v=e[1],s=e[2],c=e[3],x=i+i,h=v+v,f=s+s,m=i*x,p=i*h,M=i*f,t=v*h,y=v*f,l=s*f,T=c*x,S=c*h,b=c*f,g=n[0],E=n[1],R=n[2];return r[0]=(1-(t+l))*g,r[1]=(p+b)*g,r[2]=(M-S)*g,r[3]=0,r[4]=(p-b)*E,r[5]=(1-(m+l))*E,r[6]=(y+T)*E,r[7]=0,r[8]=(M+S)*R,r[9]=(y-T)*R,r[10]=(1-(m+t))*R,r[11]=0,r[12]=a[0],r[13]=a[1],r[14]=a[2],r[15]=1,r}function Dr(r,e,a,n,i){var v=e[0],s=e[1],c=e[2],x=e[3],h=v+v,f=s+s,m=c+c,p=v*h,M=v*f,t=v*m,y=s*f,l=s*m,T=c*m,S=x*h,b=x*f,g=x*m,E=n[0],R=n[1],L=n[2],A=i[0],P=i[1],z=i[2],I=(1-(y+T))*E,w=(M+g)*E,F=(t-b)*E,_=(M-g)*R,U=(1-(p+T))*R,X=(l+S)*R,Y=(t+b)*L,k=(l-S)*L,H=(1-(p+y))*L;return r[0]=I,r[1]=w,r[2]=F,r[3]=0,r[4]=_,r[5]=U,r[6]=X,r[7]=0,r[8]=Y,r[9]=k,r[10]=H,r[11]=0,r[12]=a[0]+A-(I*A+_*P+Y*z),r[13]=a[1]+P-(w*A+U*P+k*z),r[14]=a[2]+z-(F*A+X*P+H*z),r[15]=1,r}function Gr(r,e){var a=e[0],n=e[1],i=e[2],v=e[3],s=a+a,c=n+n,x=i+i,h=a*s,f=n*s,m=n*c,p=i*s,M=i*c,t=i*x,y=v*s,l=v*c,T=v*x;return r[0]=1-m-t,r[1]=f+T,r[2]=p-l,r[3]=0,r[4]=f-T,r[5]=1-h-t,r[6]=M+y,r[7]=0,r[8]=p+l,r[9]=M-y,r[10]=1-h-m,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function qr(r,e,a,n,i,v,s){var c=1/(a-e),x=1/(i-n),h=1/(v-s);return r[0]=v*2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=v*2*x,r[6]=0,r[7]=0,r[8]=(a+e)*c,r[9]=(i+n)*x,r[10]=(s+v)*h,r[11]=-1,r[12]=0,r[13]=0,r[14]=s*v*2*h,r[15]=0,r}function o(r,e,a,n,i){var v=1/Math.tan(e/2);if(r[0]=v/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=v,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){var s=1/(n-i);r[10]=(i+n)*s,r[14]=2*i*n*s}else r[10]=-1,r[14]=-2*n;return r}var Xr=o;function Yr(r,e,a,n,i){var v=1/Math.tan(e/2);if(r[0]=v/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=v,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){var s=1/(n-i);r[10]=i*s,r[14]=i*n*s}else r[10]=-1,r[14]=-n;return r}function Br(r,e,a,n){var i=Math.tan(e.upDegrees*Math.PI/180),v=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),c=Math.tan(e.rightDegrees*Math.PI/180),x=2/(s+c),h=2/(i+v);return r[0]=x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=h,r[6]=0,r[7]=0,r[8]=-((s-c)*x*.5),r[9]=(i-v)*h*.5,r[10]=n/(a-n),r[11]=-1,r[12]=0,r[13]=0,r[14]=n*a/(a-n),r[15]=0,r}function u(r,e,a,n,i,v,s){var c=1/(e-a),x=1/(n-i),h=1/(v-s);return r[0]=-2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*h,r[11]=0,r[12]=(e+a)*c,r[13]=(i+n)*x,r[14]=(s+v)*h,r[15]=1,r}var Vr=u;function Wr(r,e,a,n,i,v,s){var c=1/(e-a),x=1/(n-i),h=1/(v-s);return r[0]=-2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*x,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=h,r[11]=0,r[12]=(e+a)*c,r[13]=(i+n)*x,r[14]=v*h,r[15]=1,r}function kr(r,e,a,n){var i,v,s,c,x,h,f,m,p,M,t=e[0],y=e[1],l=e[2],T=n[0],S=n[1],b=n[2],g=a[0],E=a[1],R=a[2];return Math.abs(t-g)<O&&Math.abs(y-E)<O&&Math.abs(l-R)<O?Q(r):(f=t-g,m=y-E,p=l-R,M=1/Math.sqrt(f*f+m*m+p*p),f*=M,m*=M,p*=M,i=S*p-b*m,v=b*f-T*p,s=T*m-S*f,M=Math.sqrt(i*i+v*v+s*s),M?(M=1/M,i*=M,v*=M,s*=M):(i=0,v=0,s=0),c=m*s-p*v,x=p*i-f*s,h=f*v-m*i,M=Math.sqrt(c*c+x*x+h*h),M?(M=1/M,c*=M,x*=M,h*=M):(c=0,x=0,h=0),r[0]=i,r[1]=c,r[2]=f,r[3]=0,r[4]=v,r[5]=x,r[6]=m,r[7]=0,r[8]=s,r[9]=h,r[10]=p,r[11]=0,r[12]=-(i*t+v*y+s*l),r[13]=-(c*t+x*y+h*l),r[14]=-(f*t+m*y+p*l),r[15]=1,r)}function Hr(r,e,a,n){var i=e[0],v=e[1],s=e[2],c=n[0],x=n[1],h=n[2],f=i-a[0],m=v-a[1],p=s-a[2],M=f*f+m*m+p*p;M>0&&(M=1/Math.sqrt(M),f*=M,m*=M,p*=M);var t=x*p-h*m,y=h*f-c*p,l=c*m-x*f;return M=t*t+y*y+l*l,M>0&&(M=1/Math.sqrt(M),t*=M,y*=M,l*=M),r[0]=t,r[1]=y,r[2]=l,r[3]=0,r[4]=m*l-p*y,r[5]=p*t-f*l,r[6]=f*y-m*t,r[7]=0,r[8]=f,r[9]=m,r[10]=p,r[11]=0,r[12]=i,r[13]=v,r[14]=s,r[15]=1,r}function Zr(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function jr(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]+r[3]*r[3]+r[4]*r[4]+r[5]*r[5]+r[6]*r[6]+r[7]*r[7]+r[8]*r[8]+r[9]*r[9]+r[10]*r[10]+r[11]*r[11]+r[12]*r[12]+r[13]*r[13]+r[14]*r[14]+r[15]*r[15])}function Qr(r,e,a){return r[0]=e[0]+a[0],r[1]=e[1]+a[1],r[2]=e[2]+a[2],r[3]=e[3]+a[3],r[4]=e[4]+a[4],r[5]=e[5]+a[5],r[6]=e[6]+a[6],r[7]=e[7]+a[7],r[8]=e[8]+a[8],r[9]=e[9]+a[9],r[10]=e[10]+a[10],r[11]=e[11]+a[11],r[12]=e[12]+a[12],r[13]=e[13]+a[13],r[14]=e[14]+a[14],r[15]=e[15]+a[15],r}function rr(r,e,a){return r[0]=e[0]-a[0],r[1]=e[1]-a[1],r[2]=e[2]-a[2],r[3]=e[3]-a[3],r[4]=e[4]-a[4],r[5]=e[5]-a[5],r[6]=e[6]-a[6],r[7]=e[7]-a[7],r[8]=e[8]-a[8],r[9]=e[9]-a[9],r[10]=e[10]-a[10],r[11]=e[11]-a[11],r[12]=e[12]-a[12],r[13]=e[13]-a[13],r[14]=e[14]-a[14],r[15]=e[15]-a[15],r}function $r(r,e,a){return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*a,r[5]=e[5]*a,r[6]=e[6]*a,r[7]=e[7]*a,r[8]=e[8]*a,r[9]=e[9]*a,r[10]=e[10]*a,r[11]=e[11]*a,r[12]=e[12]*a,r[13]=e[13]*a,r[14]=e[14]*a,r[15]=e[15]*a,r}function Kr(r,e,a,n){return r[0]=e[0]+a[0]*n,r[1]=e[1]+a[1]*n,r[2]=e[2]+a[2]*n,r[3]=e[3]+a[3]*n,r[4]=e[4]+a[4]*n,r[5]=e[5]+a[5]*n,r[6]=e[6]+a[6]*n,r[7]=e[7]+a[7]*n,r[8]=e[8]+a[8]*n,r[9]=e[9]+a[9]*n,r[10]=e[10]+a[10]*n,r[11]=e[11]+a[11]*n,r[12]=e[12]+a[12]*n,r[13]=e[13]+a[13]*n,r[14]=e[14]+a[14]*n,r[15]=e[15]+a[15]*n,r}function Jr(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]}function or(r,e){var a=r[0],n=r[1],i=r[2],v=r[3],s=r[4],c=r[5],x=r[6],h=r[7],f=r[8],m=r[9],p=r[10],M=r[11],t=r[12],y=r[13],l=r[14],T=r[15],S=e[0],b=e[1],g=e[2],E=e[3],R=e[4],L=e[5],A=e[6],P=e[7],z=e[8],I=e[9],w=e[10],F=e[11],_=e[12],U=e[13],X=e[14],Y=e[15];return Math.abs(a-S)<=O*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(n-b)<=O*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-g)<=O*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(v-E)<=O*Math.max(1,Math.abs(v),Math.abs(E))&&Math.abs(s-R)<=O*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(c-L)<=O*Math.max(1,Math.abs(c),Math.abs(L))&&Math.abs(x-A)<=O*Math.max(1,Math.abs(x),Math.abs(A))&&Math.abs(h-P)<=O*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(f-z)<=O*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(m-I)<=O*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(p-w)<=O*Math.max(1,Math.abs(p),Math.abs(w))&&Math.abs(M-F)<=O*Math.max(1,Math.abs(M),Math.abs(F))&&Math.abs(t-_)<=O*Math.max(1,Math.abs(t),Math.abs(_))&&Math.abs(y-U)<=O*Math.max(1,Math.abs(y),Math.abs(U))&&Math.abs(l-X)<=O*Math.max(1,Math.abs(l),Math.abs(X))&&Math.abs(T-Y)<=O*Math.max(1,Math.abs(T),Math.abs(Y))}var ur=$,r1=rr;function W(r){throw alert(r),new Error(r)}var V=document.getElementById("canvas"),d=V.getContext("webgl2");d||W("webgl2 is not supported");d.getExtension("EXT_color_buffer_float")||W("EXT_color_buffer_float is not supported");var er=window.devicePixelRatio,G=Math.round(V.clientWidth*er),q=Math.round(V.clientHeight*er);V.width=G;V.height=q;d.viewport(0,0,G,q);function ar(r,e,a){let n=r.createShader(e);if(r.shaderSource(n,a),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS))return n;let v=r.getShaderInfoLog(n);r.deleteShader(n),W(`failed to compile shader:
${v}`)}function e1(r,e,a){let n=r.createProgram();if(r.attachShader(n,e),r.attachShader(n,a),r.linkProgram(n),r.getProgramParameter(n,r.LINK_STATUS))return n;let v=r.getProgramInfoLog(n);r.deleteProgram(n),W(`failed to link program:
${v}`)}function a1(r,e,a,n){n!==void 0&&r.bindVertexArray(n),r.bindBuffer(r.ARRAY_BUFFER,r.createBuffer()),r.bufferData(r.ARRAY_BUFFER,a.data,r.STATIC_DRAW),r.enableVertexAttribArray(e),r.vertexAttribPointer(e,a.size,a.type,a.normalized??!1,a.stride??0,a.offset??0),r.enableVertexAttribArray(e)}var n1=ar(d,d.VERTEX_SHADER,j),i1=ar(d,d.FRAGMENT_SHADER,Z),D=e1(d,n1,i1);d.useProgram(D);var N={attributes:{a_position:d.getAttribLocation(D,"a_position")},uniforms:{u_viewMatrix:d.getUniformLocation(D,"u_viewMatrix"),u_screenSize:d.getUniformLocation(D,"u_screenSize"),u_frame:d.getUniformLocation(D,"u_frame"),u_lastFrame:d.getUniformLocation(D,"u_lastFrame"),u_render:d.getUniformLocation(D,"u_render")}};d.uniform2f(N.uniforms.u_screenSize,.5*G/q,.5);var v1=d.createVertexArray();d.bindVertexArray(v1);a1(d,N.attributes.a_position,{data:new Float32Array([-1,-1,-1,1,1,-1,1,1,1,-1,-1,1]),size:2,type:d.FLOAT});var nr=d.createTexture();d.activeTexture(d.TEXTURE1);d.bindTexture(d.TEXTURE_2D,nr);d.texImage2D(d.TEXTURE_2D,0,d.RGBA32F,G,q,0,d.RGBA,d.FLOAT,null);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);var ir=d.createTexture();d.activeTexture(d.TEXTURE0);d.bindTexture(d.TEXTURE_2D,ir);d.texImage2D(d.TEXTURE_2D,0,d.RGBA32F,G,q,0,d.RGBA,d.FLOAT,null);var vr=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,vr);d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,ir,0);var s1=0;function sr(){d.uniform1i(N.uniforms.u_frame,s1++),d.uniformMatrix4fv(N.uniforms.u_viewMatrix,!1,B.identity(B.create())),d.uniform1i(N.uniforms.u_lastFrame,1),d.uniform1i(N.uniforms.u_render,0),d.bindFramebuffer(d.FRAMEBUFFER,vr),d.drawArrays(d.TRIANGLES,0,6),d.bindTexture(d.TEXTURE_2D,nr),d.copyTexImage2D(d.TEXTURE_2D,0,d.RGBA32F,0,0,G,q,0),d.uniform1i(N.uniforms.u_lastFrame,0),d.uniform1i(N.uniforms.u_render,1),d.bindFramebuffer(d.FRAMEBUFFER,null),d.drawArrays(d.TRIANGLES,0,6),requestAnimationFrame(sr)}requestAnimationFrame(sr);
