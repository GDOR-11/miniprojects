var cr=Object.defineProperty;var xr=(r,e)=>{for(var a in e)cr(r,a,{get:e[a],enumerable:!0})};var Z=`#version 300 es
precision highp float;struct Ray{vec3 origin;vec3 direction;};struct Material{vec3 albedo;vec3 emissivity;};struct Collision{float distance;vec3 normal;Material material;};struct Sphere{vec3 center;float radius;bool inverted;Material material;};void sphereIntersection(inout Collision current,Ray ray,Sphere sphere){vec3 oc=ray.origin-sphere.center;float b=dot(oc,ray.direction);if(b>0.0&&!sphere.inverted)return;float c=dot(oc,oc)-sphere.radius*sphere.radius;if(c<0.0!=sphere.inverted)return;float a=dot(ray.direction,ray.direction);float d=b*b-a*c;if(d<0.0)return;float t=(-b+(sphere.inverted?1.0:-1.0)*sqrt(d))/a;if(t>=current.distance&&current.distance>=0.0)return;current.distance=t;vec3 hitPoint=ray.origin+t*ray.direction;current.normal=(sphere.inverted?-1.0:1.0)*(hitPoint-sphere.center)/sphere.radius;current.material=sphere.material;}Collision sceneIntersection(Ray ray){Sphere sphere1=Sphere(vec3(0.0,-1.0,10.0),1.0,false,Material(vec3(0.0,1.0,1.0),vec3(0.0)));Sphere sphere2=Sphere(vec3(0.0,1.0,10.0),1.0,false,Material(vec3(1.0,1.0,0.0),vec3(0.0)));Sphere sphere3=Sphere(vec3(2.0,3.0,8.0),1.0,false,Material(vec3(0.0,0.0,0.0),vec3(4.0)));Sphere sphere4=Sphere(vec3(0.0,0.0,5.0),5.1,true,Material(vec3(1.0,1.0,1.0),vec3(0.0)));Collision collision;collision.distance=-1.0;sphereIntersection(collision,ray,sphere1);sphereIntersection(collision,ray,sphere2);sphereIntersection(collision,ray,sphere3);sphereIntersection(collision,ray,sphere4);return collision;}vec3 hash(vec3 p){p=fract(p*vec3(0.1031,0.1030,0.0973));p+=dot(p,p.yzx+33.33);return fract((p.xxy+p.yzz)*p.zyx);}vec3 int_hash(uvec3 x){x=((x>>8U)^ x.yzx)*1103515245U;x=((x>>8U)^ x.yzx)*1103515245U;x=((x>>8U)^ x.yzx)*1103515245U;return vec3(x)*(1.0/float(0xffffffffU));}vec3 randomUnitVector(vec3 seed){vec3 v=vec3(1.0);for(int i=0;length(v)>1.0||length(v)==0.0;i++){vec3 h=seed=hash(seed-vec3(1.0));v=h*2.0-vec3(1.0);}return normalize(v);}float colorCorrection(float intensity){return intensity<=0.0031308?12.92*intensity:1.055*pow(intensity,1.0/2.4)-0.055;}uniform mat4 u_viewMatrix;uniform int u_frame;uniform sampler2D u_lastFrame;uniform bool u_render;in vec3 v_pixelLocation;out vec4 outColor;void main(){vec2 uv=gl_FragCoord.xy/vec2(textureSize(u_lastFrame,0));if(u_render){outColor=texture(u_lastFrame,uv)/float(u_frame);outColor=vec4(colorCorrection(outColor.r),colorCorrection(outColor.g),colorCorrection(outColor.b),1.0);return;}vec4 origin=u_viewMatrix*vec4(0.0,0.0,0.0,1.0);vec4 direction=u_viewMatrix*vec4(normalize(v_pixelLocation),0.0);vec3 seed=int_hash(uvec3(gl_FragCoord.xy,u_frame));vec3 color=vec3(0.0);vec3 contribution=vec3(1.0);Ray ray=Ray(origin.xyz,direction.xyz);for(int i=0;i<5;i++){Collision collision=sceneIntersection(ray);vec3 hitPoint=ray.origin+ray.direction*collision.distance+collision.normal*0.001;if(collision.distance<0.0)break;color+=contribution*collision.material.emissivity;contribution*=collision.material.albedo;if(contribution==vec3(0.0))break;ray.origin=hitPoint;ray.direction=randomUnitVector(seed=hash(seed));if(dot(ray.direction,collision.normal)<0.0){ray.direction=-ray.direction;}contribution*=dot(ray.direction,collision.normal);}if(u_frame==0){outColor=vec4(color,1.0);return;}outColor=texture(u_lastFrame,uv)+vec4(color,1.0);}`;var j=`#version 300 es
uniform vec2 u_screenSize;out vec3 v_pixelLocation;in vec2 a_position;void main(){gl_Position=vec4(a_position,0,1);v_pixelLocation=vec3(0.5*a_position*u_screenSize,1);}`;var U=1e-6,C=typeof Float32Array<"u"?Float32Array:Array;var m1=Math.PI/180,M1=180/Math.PI;var B={};xr(B,{add:()=>Qr,adjoint:()=>yr,clone:()=>lr,copy:()=>mr,create:()=>fr,decompose:()=>Or,determinant:()=>Er,equals:()=>or,exactEquals:()=>Jr,frob:()=>jr,fromQuat:()=>Gr,fromQuat2:()=>Fr,fromRotation:()=>Lr,fromRotationTranslation:()=>K,fromRotationTranslationScale:()=>Cr,fromRotationTranslationScaleOrigin:()=>Dr,fromScaling:()=>_r,fromTranslation:()=>zr,fromValues:()=>Mr,fromXRotation:()=>Pr,fromYRotation:()=>Ir,fromZRotation:()=>wr,frustum:()=>Xr,getRotation:()=>Nr,getScaling:()=>J,getTranslation:()=>Ur,identity:()=>Q,invert:()=>dr,lookAt:()=>kr,mul:()=>ur,multiply:()=>$,multiplyScalar:()=>$r,multiplyScalarAndAdd:()=>Kr,ortho:()=>Vr,orthoNO:()=>u,orthoZO:()=>Wr,perspective:()=>qr,perspectiveFromFieldOfView:()=>Br,perspectiveNO:()=>o,perspectiveZO:()=>Yr,rotate:()=>gr,rotateX:()=>br,rotateY:()=>Sr,rotateZ:()=>Ar,scale:()=>Rr,set:()=>pr,str:()=>Zr,sub:()=>r1,subtract:()=>rr,targetTo:()=>Hr,translate:()=>Tr,transpose:()=>tr});function fr(){var r=new C(16);return C!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function lr(r){var e=new C(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function mr(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Mr(r,e,a,n,i,v,s,c,h,x,f,m,p,M,d,y){var l=new C(16);return l[0]=r,l[1]=e,l[2]=a,l[3]=n,l[4]=i,l[5]=v,l[6]=s,l[7]=c,l[8]=h,l[9]=x,l[10]=f,l[11]=m,l[12]=p,l[13]=M,l[14]=d,l[15]=y,l}function pr(r,e,a,n,i,v,s,c,h,x,f,m,p,M,d,y,l){return r[0]=e,r[1]=a,r[2]=n,r[3]=i,r[4]=v,r[5]=s,r[6]=c,r[7]=h,r[8]=x,r[9]=f,r[10]=m,r[11]=p,r[12]=M,r[13]=d,r[14]=y,r[15]=l,r}function Q(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function tr(r,e){if(r===e){var a=e[1],n=e[2],i=e[3],v=e[6],s=e[7],c=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=a,r[6]=e[9],r[7]=e[13],r[8]=n,r[9]=v,r[11]=e[14],r[12]=i,r[13]=s,r[14]=c}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r}function dr(r,e){var a=e[0],n=e[1],i=e[2],v=e[3],s=e[4],c=e[5],h=e[6],x=e[7],f=e[8],m=e[9],p=e[10],M=e[11],d=e[12],y=e[13],l=e[14],b=e[15],A=a*c-n*s,g=a*h-i*s,E=a*x-v*s,T=n*h-i*c,R=n*x-v*c,L=i*x-v*h,z=f*y-m*d,P=f*l-p*d,S=f*b-M*d,I=m*l-p*y,w=m*b-M*y,F=p*b-M*l,_=A*F-g*w+E*I+T*S-R*P+L*z;return _?(_=1/_,r[0]=(c*F-h*w+x*I)*_,r[1]=(i*w-n*F-v*I)*_,r[2]=(y*L-l*R+b*T)*_,r[3]=(p*R-m*L-M*T)*_,r[4]=(h*S-s*F-x*P)*_,r[5]=(a*F-i*S+v*P)*_,r[6]=(l*E-d*L-b*g)*_,r[7]=(f*L-p*E+M*g)*_,r[8]=(s*w-c*S+x*z)*_,r[9]=(n*S-a*w-v*z)*_,r[10]=(d*R-y*E+b*A)*_,r[11]=(m*E-f*R-M*A)*_,r[12]=(c*P-s*I-h*z)*_,r[13]=(a*I-n*P+i*z)*_,r[14]=(y*g-d*T-l*A)*_,r[15]=(f*T-m*g+p*A)*_,r):null}function yr(r,e){var a=e[0],n=e[1],i=e[2],v=e[3],s=e[4],c=e[5],h=e[6],x=e[7],f=e[8],m=e[9],p=e[10],M=e[11],d=e[12],y=e[13],l=e[14],b=e[15],A=a*c-n*s,g=a*h-i*s,E=a*x-v*s,T=n*h-i*c,R=n*x-v*c,L=i*x-v*h,z=f*y-m*d,P=f*l-p*d,S=f*b-M*d,I=m*l-p*y,w=m*b-M*y,F=p*b-M*l;return r[0]=c*F-h*w+x*I,r[1]=i*w-n*F-v*I,r[2]=y*L-l*R+b*T,r[3]=p*R-m*L-M*T,r[4]=h*S-s*F-x*P,r[5]=a*F-i*S+v*P,r[6]=l*E-d*L-b*g,r[7]=f*L-p*E+M*g,r[8]=s*w-c*S+x*z,r[9]=n*S-a*w-v*z,r[10]=d*R-y*E+b*A,r[11]=m*E-f*R-M*A,r[12]=c*P-s*I-h*z,r[13]=a*I-n*P+i*z,r[14]=y*g-d*T-l*A,r[15]=f*T-m*g+p*A,r}function Er(r){var e=r[0],a=r[1],n=r[2],i=r[3],v=r[4],s=r[5],c=r[6],h=r[7],x=r[8],f=r[9],m=r[10],p=r[11],M=r[12],d=r[13],y=r[14],l=r[15],b=e*s-a*v,A=e*c-n*v,g=a*c-n*s,E=x*d-f*M,T=x*y-m*M,R=f*y-m*d,L=e*R-a*T+n*E,z=v*R-s*T+c*E,P=x*g-f*A+m*b,S=M*g-d*A+y*b;return h*L-i*z+l*P-p*S}function $(r,e,a){var n=e[0],i=e[1],v=e[2],s=e[3],c=e[4],h=e[5],x=e[6],f=e[7],m=e[8],p=e[9],M=e[10],d=e[11],y=e[12],l=e[13],b=e[14],A=e[15],g=a[0],E=a[1],T=a[2],R=a[3];return r[0]=g*n+E*c+T*m+R*y,r[1]=g*i+E*h+T*p+R*l,r[2]=g*v+E*x+T*M+R*b,r[3]=g*s+E*f+T*d+R*A,g=a[4],E=a[5],T=a[6],R=a[7],r[4]=g*n+E*c+T*m+R*y,r[5]=g*i+E*h+T*p+R*l,r[6]=g*v+E*x+T*M+R*b,r[7]=g*s+E*f+T*d+R*A,g=a[8],E=a[9],T=a[10],R=a[11],r[8]=g*n+E*c+T*m+R*y,r[9]=g*i+E*h+T*p+R*l,r[10]=g*v+E*x+T*M+R*b,r[11]=g*s+E*f+T*d+R*A,g=a[12],E=a[13],T=a[14],R=a[15],r[12]=g*n+E*c+T*m+R*y,r[13]=g*i+E*h+T*p+R*l,r[14]=g*v+E*x+T*M+R*b,r[15]=g*s+E*f+T*d+R*A,r}function Tr(r,e,a){var n=a[0],i=a[1],v=a[2],s,c,h,x,f,m,p,M,d,y,l,b;return e===r?(r[12]=e[0]*n+e[4]*i+e[8]*v+e[12],r[13]=e[1]*n+e[5]*i+e[9]*v+e[13],r[14]=e[2]*n+e[6]*i+e[10]*v+e[14],r[15]=e[3]*n+e[7]*i+e[11]*v+e[15]):(s=e[0],c=e[1],h=e[2],x=e[3],f=e[4],m=e[5],p=e[6],M=e[7],d=e[8],y=e[9],l=e[10],b=e[11],r[0]=s,r[1]=c,r[2]=h,r[3]=x,r[4]=f,r[5]=m,r[6]=p,r[7]=M,r[8]=d,r[9]=y,r[10]=l,r[11]=b,r[12]=s*n+f*i+d*v+e[12],r[13]=c*n+m*i+y*v+e[13],r[14]=h*n+p*i+l*v+e[14],r[15]=x*n+M*i+b*v+e[15]),r}function Rr(r,e,a){var n=a[0],i=a[1],v=a[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*v,r[9]=e[9]*v,r[10]=e[10]*v,r[11]=e[11]*v,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function gr(r,e,a,n){var i=n[0],v=n[1],s=n[2],c=Math.sqrt(i*i+v*v+s*s),h,x,f,m,p,M,d,y,l,b,A,g,E,T,R,L,z,P,S,I,w,F,_,N;return c<U?null:(c=1/c,i*=c,v*=c,s*=c,h=Math.sin(a),x=Math.cos(a),f=1-x,m=e[0],p=e[1],M=e[2],d=e[3],y=e[4],l=e[5],b=e[6],A=e[7],g=e[8],E=e[9],T=e[10],R=e[11],L=i*i*f+x,z=v*i*f+s*h,P=s*i*f-v*h,S=i*v*f-s*h,I=v*v*f+x,w=s*v*f+i*h,F=i*s*f+v*h,_=v*s*f-i*h,N=s*s*f+x,r[0]=m*L+y*z+g*P,r[1]=p*L+l*z+E*P,r[2]=M*L+b*z+T*P,r[3]=d*L+A*z+R*P,r[4]=m*S+y*I+g*w,r[5]=p*S+l*I+E*w,r[6]=M*S+b*I+T*w,r[7]=d*S+A*I+R*w,r[8]=m*F+y*_+g*N,r[9]=p*F+l*_+E*N,r[10]=M*F+b*_+T*N,r[11]=d*F+A*_+R*N,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)}function br(r,e,a){var n=Math.sin(a),i=Math.cos(a),v=e[4],s=e[5],c=e[6],h=e[7],x=e[8],f=e[9],m=e[10],p=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=v*i+x*n,r[5]=s*i+f*n,r[6]=c*i+m*n,r[7]=h*i+p*n,r[8]=x*i-v*n,r[9]=f*i-s*n,r[10]=m*i-c*n,r[11]=p*i-h*n,r}function Sr(r,e,a){var n=Math.sin(a),i=Math.cos(a),v=e[0],s=e[1],c=e[2],h=e[3],x=e[8],f=e[9],m=e[10],p=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=v*i-x*n,r[1]=s*i-f*n,r[2]=c*i-m*n,r[3]=h*i-p*n,r[8]=v*n+x*i,r[9]=s*n+f*i,r[10]=c*n+m*i,r[11]=h*n+p*i,r}function Ar(r,e,a){var n=Math.sin(a),i=Math.cos(a),v=e[0],s=e[1],c=e[2],h=e[3],x=e[4],f=e[5],m=e[6],p=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=v*i+x*n,r[1]=s*i+f*n,r[2]=c*i+m*n,r[3]=h*i+p*n,r[4]=x*i-v*n,r[5]=f*i-s*n,r[6]=m*i-c*n,r[7]=p*i-h*n,r}function zr(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r}function _r(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Lr(r,e,a){var n=a[0],i=a[1],v=a[2],s=Math.sqrt(n*n+i*i+v*v),c,h,x;return s<U?null:(s=1/s,n*=s,i*=s,v*=s,c=Math.sin(e),h=Math.cos(e),x=1-h,r[0]=n*n*x+h,r[1]=i*n*x+v*c,r[2]=v*n*x-i*c,r[3]=0,r[4]=n*i*x-v*c,r[5]=i*i*x+h,r[6]=v*i*x+n*c,r[7]=0,r[8]=n*v*x+i*c,r[9]=i*v*x-n*c,r[10]=v*v*x+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Pr(r,e){var a=Math.sin(e),n=Math.cos(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=a,r[7]=0,r[8]=0,r[9]=-a,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ir(r,e){var a=Math.sin(e),n=Math.cos(e);return r[0]=n,r[1]=0,r[2]=-a,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=a,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function wr(r,e){var a=Math.sin(e),n=Math.cos(e);return r[0]=n,r[1]=a,r[2]=0,r[3]=0,r[4]=-a,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function K(r,e,a){var n=e[0],i=e[1],v=e[2],s=e[3],c=n+n,h=i+i,x=v+v,f=n*c,m=n*h,p=n*x,M=i*h,d=i*x,y=v*x,l=s*c,b=s*h,A=s*x;return r[0]=1-(M+y),r[1]=m+A,r[2]=p-b,r[3]=0,r[4]=m-A,r[5]=1-(f+y),r[6]=d+l,r[7]=0,r[8]=p+b,r[9]=d-l,r[10]=1-(f+M),r[11]=0,r[12]=a[0],r[13]=a[1],r[14]=a[2],r[15]=1,r}function Fr(r,e){var a=new C(3),n=-e[0],i=-e[1],v=-e[2],s=e[3],c=e[4],h=e[5],x=e[6],f=e[7],m=n*n+i*i+v*v+s*s;return m>0?(a[0]=(c*s+f*n+h*v-x*i)*2/m,a[1]=(h*s+f*i+x*n-c*v)*2/m,a[2]=(x*s+f*v+c*i-h*n)*2/m):(a[0]=(c*s+f*n+h*v-x*i)*2,a[1]=(h*s+f*i+x*n-c*v)*2,a[2]=(x*s+f*v+c*i-h*n)*2),K(r,e,a),r}function Ur(r,e){return r[0]=e[12],r[1]=e[13],r[2]=e[14],r}function J(r,e){var a=e[0],n=e[1],i=e[2],v=e[4],s=e[5],c=e[6],h=e[8],x=e[9],f=e[10];return r[0]=Math.sqrt(a*a+n*n+i*i),r[1]=Math.sqrt(v*v+s*s+c*c),r[2]=Math.sqrt(h*h+x*x+f*f),r}function Nr(r,e){var a=new C(3);J(a,e);var n=1/a[0],i=1/a[1],v=1/a[2],s=e[0]*n,c=e[1]*i,h=e[2]*v,x=e[4]*n,f=e[5]*i,m=e[6]*v,p=e[8]*n,M=e[9]*i,d=e[10]*v,y=s+f+d,l=0;return y>0?(l=Math.sqrt(y+1)*2,r[3]=.25*l,r[0]=(m-M)/l,r[1]=(p-h)/l,r[2]=(c-x)/l):s>f&&s>d?(l=Math.sqrt(1+s-f-d)*2,r[3]=(m-M)/l,r[0]=.25*l,r[1]=(c+x)/l,r[2]=(p+h)/l):f>d?(l=Math.sqrt(1+f-s-d)*2,r[3]=(p-h)/l,r[0]=(c+x)/l,r[1]=.25*l,r[2]=(m+M)/l):(l=Math.sqrt(1+d-s-f)*2,r[3]=(c-x)/l,r[0]=(p+h)/l,r[1]=(m+M)/l,r[2]=.25*l),r}function Or(r,e,a,n){e[0]=n[12],e[1]=n[13],e[2]=n[14];var i=n[0],v=n[1],s=n[2],c=n[4],h=n[5],x=n[6],f=n[8],m=n[9],p=n[10];a[0]=Math.sqrt(i*i+v*v+s*s),a[1]=Math.sqrt(c*c+h*h+x*x),a[2]=Math.sqrt(f*f+m*m+p*p);var M=1/a[0],d=1/a[1],y=1/a[2],l=i*M,b=v*d,A=s*y,g=c*M,E=h*d,T=x*y,R=f*M,L=m*d,z=p*y,P=l+E+z,S=0;return P>0?(S=Math.sqrt(P+1)*2,r[3]=.25*S,r[0]=(T-L)/S,r[1]=(R-A)/S,r[2]=(b-g)/S):l>E&&l>z?(S=Math.sqrt(1+l-E-z)*2,r[3]=(T-L)/S,r[0]=.25*S,r[1]=(b+g)/S,r[2]=(R+A)/S):E>z?(S=Math.sqrt(1+E-l-z)*2,r[3]=(R-A)/S,r[0]=(b+g)/S,r[1]=.25*S,r[2]=(T+L)/S):(S=Math.sqrt(1+z-l-E)*2,r[3]=(b-g)/S,r[0]=(R+A)/S,r[1]=(T+L)/S,r[2]=.25*S),r}function Cr(r,e,a,n){var i=e[0],v=e[1],s=e[2],c=e[3],h=i+i,x=v+v,f=s+s,m=i*h,p=i*x,M=i*f,d=v*x,y=v*f,l=s*f,b=c*h,A=c*x,g=c*f,E=n[0],T=n[1],R=n[2];return r[0]=(1-(d+l))*E,r[1]=(p+g)*E,r[2]=(M-A)*E,r[3]=0,r[4]=(p-g)*T,r[5]=(1-(m+l))*T,r[6]=(y+b)*T,r[7]=0,r[8]=(M+A)*R,r[9]=(y-b)*R,r[10]=(1-(m+d))*R,r[11]=0,r[12]=a[0],r[13]=a[1],r[14]=a[2],r[15]=1,r}function Dr(r,e,a,n,i){var v=e[0],s=e[1],c=e[2],h=e[3],x=v+v,f=s+s,m=c+c,p=v*x,M=v*f,d=v*m,y=s*f,l=s*m,b=c*m,A=h*x,g=h*f,E=h*m,T=n[0],R=n[1],L=n[2],z=i[0],P=i[1],S=i[2],I=(1-(y+b))*T,w=(M+E)*T,F=(d-g)*T,_=(M-E)*R,N=(1-(p+b))*R,q=(l+A)*R,Y=(d+g)*L,k=(l-A)*L,H=(1-(p+y))*L;return r[0]=I,r[1]=w,r[2]=F,r[3]=0,r[4]=_,r[5]=N,r[6]=q,r[7]=0,r[8]=Y,r[9]=k,r[10]=H,r[11]=0,r[12]=a[0]+z-(I*z+_*P+Y*S),r[13]=a[1]+P-(w*z+N*P+k*S),r[14]=a[2]+S-(F*z+q*P+H*S),r[15]=1,r}function Gr(r,e){var a=e[0],n=e[1],i=e[2],v=e[3],s=a+a,c=n+n,h=i+i,x=a*s,f=n*s,m=n*c,p=i*s,M=i*c,d=i*h,y=v*s,l=v*c,b=v*h;return r[0]=1-m-d,r[1]=f+b,r[2]=p-l,r[3]=0,r[4]=f-b,r[5]=1-x-d,r[6]=M+y,r[7]=0,r[8]=p+l,r[9]=M-y,r[10]=1-x-m,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Xr(r,e,a,n,i,v,s){var c=1/(a-e),h=1/(i-n),x=1/(v-s);return r[0]=v*2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=v*2*h,r[6]=0,r[7]=0,r[8]=(a+e)*c,r[9]=(i+n)*h,r[10]=(s+v)*x,r[11]=-1,r[12]=0,r[13]=0,r[14]=s*v*2*x,r[15]=0,r}function o(r,e,a,n,i){var v=1/Math.tan(e/2);if(r[0]=v/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=v,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){var s=1/(n-i);r[10]=(i+n)*s,r[14]=2*i*n*s}else r[10]=-1,r[14]=-2*n;return r}var qr=o;function Yr(r,e,a,n,i){var v=1/Math.tan(e/2);if(r[0]=v/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=v,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,i!=null&&i!==1/0){var s=1/(n-i);r[10]=i*s,r[14]=i*n*s}else r[10]=-1,r[14]=-n;return r}function Br(r,e,a,n){var i=Math.tan(e.upDegrees*Math.PI/180),v=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),c=Math.tan(e.rightDegrees*Math.PI/180),h=2/(s+c),x=2/(i+v);return r[0]=h,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=x,r[6]=0,r[7]=0,r[8]=-((s-c)*h*.5),r[9]=(i-v)*x*.5,r[10]=n/(a-n),r[11]=-1,r[12]=0,r[13]=0,r[14]=n*a/(a-n),r[15]=0,r}function u(r,e,a,n,i,v,s){var c=1/(e-a),h=1/(n-i),x=1/(v-s);return r[0]=-2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*x,r[11]=0,r[12]=(e+a)*c,r[13]=(i+n)*h,r[14]=(s+v)*x,r[15]=1,r}var Vr=u;function Wr(r,e,a,n,i,v,s){var c=1/(e-a),h=1/(n-i),x=1/(v-s);return r[0]=-2*c,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*h,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=x,r[11]=0,r[12]=(e+a)*c,r[13]=(i+n)*h,r[14]=v*x,r[15]=1,r}function kr(r,e,a,n){var i,v,s,c,h,x,f,m,p,M,d=e[0],y=e[1],l=e[2],b=n[0],A=n[1],g=n[2],E=a[0],T=a[1],R=a[2];return Math.abs(d-E)<U&&Math.abs(y-T)<U&&Math.abs(l-R)<U?Q(r):(f=d-E,m=y-T,p=l-R,M=1/Math.sqrt(f*f+m*m+p*p),f*=M,m*=M,p*=M,i=A*p-g*m,v=g*f-b*p,s=b*m-A*f,M=Math.sqrt(i*i+v*v+s*s),M?(M=1/M,i*=M,v*=M,s*=M):(i=0,v=0,s=0),c=m*s-p*v,h=p*i-f*s,x=f*v-m*i,M=Math.sqrt(c*c+h*h+x*x),M?(M=1/M,c*=M,h*=M,x*=M):(c=0,h=0,x=0),r[0]=i,r[1]=c,r[2]=f,r[3]=0,r[4]=v,r[5]=h,r[6]=m,r[7]=0,r[8]=s,r[9]=x,r[10]=p,r[11]=0,r[12]=-(i*d+v*y+s*l),r[13]=-(c*d+h*y+x*l),r[14]=-(f*d+m*y+p*l),r[15]=1,r)}function Hr(r,e,a,n){var i=e[0],v=e[1],s=e[2],c=n[0],h=n[1],x=n[2],f=i-a[0],m=v-a[1],p=s-a[2],M=f*f+m*m+p*p;M>0&&(M=1/Math.sqrt(M),f*=M,m*=M,p*=M);var d=h*p-x*m,y=x*f-c*p,l=c*m-h*f;return M=d*d+y*y+l*l,M>0&&(M=1/Math.sqrt(M),d*=M,y*=M,l*=M),r[0]=d,r[1]=y,r[2]=l,r[3]=0,r[4]=m*l-p*y,r[5]=p*d-f*l,r[6]=f*y-m*d,r[7]=0,r[8]=f,r[9]=m,r[10]=p,r[11]=0,r[12]=i,r[13]=v,r[14]=s,r[15]=1,r}function Zr(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"}function jr(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]+r[3]*r[3]+r[4]*r[4]+r[5]*r[5]+r[6]*r[6]+r[7]*r[7]+r[8]*r[8]+r[9]*r[9]+r[10]*r[10]+r[11]*r[11]+r[12]*r[12]+r[13]*r[13]+r[14]*r[14]+r[15]*r[15])}function Qr(r,e,a){return r[0]=e[0]+a[0],r[1]=e[1]+a[1],r[2]=e[2]+a[2],r[3]=e[3]+a[3],r[4]=e[4]+a[4],r[5]=e[5]+a[5],r[6]=e[6]+a[6],r[7]=e[7]+a[7],r[8]=e[8]+a[8],r[9]=e[9]+a[9],r[10]=e[10]+a[10],r[11]=e[11]+a[11],r[12]=e[12]+a[12],r[13]=e[13]+a[13],r[14]=e[14]+a[14],r[15]=e[15]+a[15],r}function rr(r,e,a){return r[0]=e[0]-a[0],r[1]=e[1]-a[1],r[2]=e[2]-a[2],r[3]=e[3]-a[3],r[4]=e[4]-a[4],r[5]=e[5]-a[5],r[6]=e[6]-a[6],r[7]=e[7]-a[7],r[8]=e[8]-a[8],r[9]=e[9]-a[9],r[10]=e[10]-a[10],r[11]=e[11]-a[11],r[12]=e[12]-a[12],r[13]=e[13]-a[13],r[14]=e[14]-a[14],r[15]=e[15]-a[15],r}function $r(r,e,a){return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*a,r[5]=e[5]*a,r[6]=e[6]*a,r[7]=e[7]*a,r[8]=e[8]*a,r[9]=e[9]*a,r[10]=e[10]*a,r[11]=e[11]*a,r[12]=e[12]*a,r[13]=e[13]*a,r[14]=e[14]*a,r[15]=e[15]*a,r}function Kr(r,e,a,n){return r[0]=e[0]+a[0]*n,r[1]=e[1]+a[1]*n,r[2]=e[2]+a[2]*n,r[3]=e[3]+a[3]*n,r[4]=e[4]+a[4]*n,r[5]=e[5]+a[5]*n,r[6]=e[6]+a[6]*n,r[7]=e[7]+a[7]*n,r[8]=e[8]+a[8]*n,r[9]=e[9]+a[9]*n,r[10]=e[10]+a[10]*n,r[11]=e[11]+a[11]*n,r[12]=e[12]+a[12]*n,r[13]=e[13]+a[13]*n,r[14]=e[14]+a[14]*n,r[15]=e[15]+a[15]*n,r}function Jr(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]}function or(r,e){var a=r[0],n=r[1],i=r[2],v=r[3],s=r[4],c=r[5],h=r[6],x=r[7],f=r[8],m=r[9],p=r[10],M=r[11],d=r[12],y=r[13],l=r[14],b=r[15],A=e[0],g=e[1],E=e[2],T=e[3],R=e[4],L=e[5],z=e[6],P=e[7],S=e[8],I=e[9],w=e[10],F=e[11],_=e[12],N=e[13],q=e[14],Y=e[15];return Math.abs(a-A)<=U*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(n-g)<=U*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(i-E)<=U*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(v-T)<=U*Math.max(1,Math.abs(v),Math.abs(T))&&Math.abs(s-R)<=U*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(c-L)<=U*Math.max(1,Math.abs(c),Math.abs(L))&&Math.abs(h-z)<=U*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(x-P)<=U*Math.max(1,Math.abs(x),Math.abs(P))&&Math.abs(f-S)<=U*Math.max(1,Math.abs(f),Math.abs(S))&&Math.abs(m-I)<=U*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(p-w)<=U*Math.max(1,Math.abs(p),Math.abs(w))&&Math.abs(M-F)<=U*Math.max(1,Math.abs(M),Math.abs(F))&&Math.abs(d-_)<=U*Math.max(1,Math.abs(d),Math.abs(_))&&Math.abs(y-N)<=U*Math.max(1,Math.abs(y),Math.abs(N))&&Math.abs(l-q)<=U*Math.max(1,Math.abs(l),Math.abs(q))&&Math.abs(b-Y)<=U*Math.max(1,Math.abs(b),Math.abs(Y))}var ur=$,r1=rr;function W(r){throw alert(r),new Error(r)}var V=document.getElementById("canvas"),t=V.getContext("webgl2");t||W("webgl2 is not supported");t.getExtension("EXT_color_buffer_float")||W("EXT_color_buffer_float is not supported");var er=window.devicePixelRatio,G=Math.round(V.clientWidth*er),X=Math.round(V.clientHeight*er);V.width=G;V.height=X;t.viewport(0,0,G,X);function ar(r,e,a){let n=r.createShader(e);if(r.shaderSource(n,a),r.compileShader(n),r.getShaderParameter(n,r.COMPILE_STATUS))return n;let v=r.getShaderInfoLog(n);r.deleteShader(n),W(`failed to compile shader:
${v}`)}function e1(r,e,a){let n=r.createProgram();if(r.attachShader(n,e),r.attachShader(n,a),r.linkProgram(n),r.getProgramParameter(n,r.LINK_STATUS))return n;let v=r.getProgramInfoLog(n);r.deleteProgram(n),W(`failed to link program:
${v}`)}function a1(r,e,a,n){n!==void 0&&r.bindVertexArray(n),r.bindBuffer(r.ARRAY_BUFFER,r.createBuffer()),r.bufferData(r.ARRAY_BUFFER,a.data,r.STATIC_DRAW),r.enableVertexAttribArray(e),r.vertexAttribPointer(e,a.size,a.type,a.normalized??!1,a.stride??0,a.offset??0),r.enableVertexAttribArray(e)}var n1=ar(t,t.VERTEX_SHADER,j),i1=ar(t,t.FRAGMENT_SHADER,Z),D=e1(t,n1,i1);t.useProgram(D);var O={attributes:{a_position:t.getAttribLocation(D,"a_position")},uniforms:{u_viewMatrix:t.getUniformLocation(D,"u_viewMatrix"),u_screenSize:t.getUniformLocation(D,"u_screenSize"),u_frame:t.getUniformLocation(D,"u_frame"),u_lastFrame:t.getUniformLocation(D,"u_lastFrame"),u_render:t.getUniformLocation(D,"u_render")}};t.uniform2f(O.uniforms.u_screenSize,.5*G/X,.5);var v1=t.createVertexArray();t.bindVertexArray(v1);a1(t,O.attributes.a_position,{data:new Float32Array([-1,-1,-1,1,1,-1,1,1,1,-1,-1,1]),size:2,type:t.FLOAT});var nr=t.createTexture();t.activeTexture(t.TEXTURE1);t.bindTexture(t.TEXTURE_2D,nr);t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,G,X,0,t.RGBA,t.FLOAT,null);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var ir=t.createTexture();t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,ir);t.texImage2D(t.TEXTURE_2D,0,t.RGBA32F,G,X,0,t.RGBA,t.FLOAT,null);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var vr=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,vr);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,ir,0);var s1=0;function sr(){t.uniform1i(O.uniforms.u_frame,s1++),t.uniformMatrix4fv(O.uniforms.u_viewMatrix,!1,B.identity(B.create())),t.uniform1i(O.uniforms.u_lastFrame,1),t.uniform1i(O.uniforms.u_render,0),t.bindFramebuffer(t.FRAMEBUFFER,vr),t.drawArrays(t.TRIANGLES,0,6),t.bindTexture(t.TEXTURE_2D,nr),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA32F,0,0,G,X,0),t.uniform1i(O.uniforms.u_lastFrame,0),t.uniform1i(O.uniforms.u_render,1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.drawArrays(t.TRIANGLES,0,6),requestAnimationFrame(sr)}requestAnimationFrame(sr);
